/*! power by kodexplorer ver3.45(2017-04-13) [build 1492084211388] */
var animate_time=160;define("app/src/edit/main",["lib/jquery-lib","lib/util","lib/contextMenu/jquery-contextMenu","lib/artDialog/jquery-artDialog","../../common/core","./edit","./preview","./preview_markdown","./function_list","./markdownTools","lib/ace/src-min-noconflict/ext-modelist","./taskTap","./toolbar"],function(e){e("lib/jquery-lib"),e("lib/util"),e("lib/contextMenu/jquery-contextMenu"),e("lib/artDialog/jquery-artDialog"),core=e("../../common/core"),Editor=e("./edit"),Tap=e("./taskTap"),Toolbar=e("./toolbar"),rightMenu=Tap.rightMenu,$(document).ready(function(){core.init(),Editor.init(),Toolbar.init(),Tap.init(),e.async("lib/code_beautify"),$("a,img").attr("draggable","false"),setTimeout(function(){t()},300);var t=function(){var e=window.location.href.indexOf("#filename=");if(e>0){var t=window.location.href.substr(e+"#filename=".length);return Editor.add(t),void 0}Editor.getParentEditor(function(e){for(var t=e.ui.fileHistory(),i=0;t.length>i;i++)Editor.add(t[i]);0==t.length&&Editor.add("")})};$(window).bind("resize",function(){Tap.resetWidth("resize")}),navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)&&"1"===Cookie.get("forceWap")&&$("body").addClass("forceWap"),window.onbeforeunload=function(){return Editor.hasFileSave()?LNG.if_save_file:void 0}})}),define("app/common/core",[],function(require,exports){tpl_search_box=require("./tpl/search.html"),tpl_search_list=require("./tpl/search_list.html"),tpl_upload=require("./tpl/upload.html"),tpl_file_info=require("./tpl/fileinfo/file_info.html"),tpl_path_info=require("./tpl/fileinfo/path_info.html"),tpl_zipview=require("./tpl/zipview.html");var search=require("./core.search"),tools=require("./core.tools"),upload=require("./core.upload"),api=require("./core.api"),playSound=require("./core.playSound"),zipView=require("./core.zipView");pathHashEncode=function(e){return hashEncode(e)},pathHashDecode=function(e){return hashDecode(e)};var initFirst=function(){if(window.require=require,template.config("escape",!1),template.config("compress",!0),template.helper("core",core),template.helper("window",window),"undefined"!=typeof G&&(1!=G.is_root&&$(".menu_system_setting").remove(),G.is_root||1==AUTH["system_member:get"]||1==AUTH["system_group:get"]||$(".menu_system_group").remove(),G.user_config&&"0"==G.user_config.animate_open&&($.dialog.defaults.animate=!1),resetHost()),$("html").bind("click",function(e){if(0==$(e.target).parents(".context-menu-list").length)try{rightMenu.hidden()}catch(e){}}),$.dialog.defaults.animate&&loadRipple(["a","button",".context-menu-item","#picker",".menuShareButton",".menuRecycleButton",".section .list"],[".disabled",".disable",".ztree",".disable-ripple"]),$("a,img").attr("draggable","false"),$.ajaxSetup({headers:{"X-CSRF-TOKEN":Cookie.get("X-CSRF-TOKEN")}}),$(".common_footer [forceWap]").click(function(){var e=$(this).attr("forceWap");Cookie.set("forceWap",e),window.location.reload()}),core.setSkinDiy(),core.tools.init(),playserSupport(),"array"==$.type(window.kodReady))for(var e=0;window.kodReady.length>e;e++)window.kodReady[e]();titleTips()},resetHost=function(){var e=window.location.port?":"+window.location.port:"";G.web_host=window.location.protocol+"//"+window.location.hostname+e+"/",G.app_host=rtrim(G.web_host,"/")+window.location.pathname.replace("index.php","")},playserSupport=function(){var e={ie:{music:["mp3","m4a","aac"],movie:["mp4","m4v","flv","mov","f4v"]},chrome:{music:["mp3","wav","m4a","aac","oga","ogg","webma"],movie:["mp4","m4v","flv","mov","f4v","ogv","webm","webmv"]}},t=!!window.ActiveXObject||"ActiveXObject"in window,i="chrome";t&&(i="ie"),core.filetypes.music=e[i].music,core.filetypes.movie=e[i].movie},titleTips=function(){isWap()||require.async(["lib/poshytip/jquery.poshytip.js","lib/poshytip/skin.css"],function(){var e=$("[title]");e.poshytip({className:"ptips-skin",liveEvents:!0,slide:!1,alignTo:"cursor",alignX:"right",alignY:"bottom",showAniDuration:150,hideAniDuration:200,offsetY:10,offsetX:20,showTimeout:function(){var e=1500;return $(this).attr("title-timeout")&&(e=parseInt($(this).attr("title-timeout"))),e},content:function(){var e=$(this).data("title.poshytip");if($(this).attr("title-data")){var t=$($(this).attr("title-data"));e=t.is("input")||t.is("textarea")?t.val():t.html()}return e=e?e:"",e.replace(/\n/g,"<br/>")}}),$("body").bind("mousedown click",function(){$(e).poshytip("hide"),$(".ptips-skin").remove()}),$("input,textarea").live("focus",function(){$(e).poshytip("hide"),$(".ptips-skin").remove()})})};return{search:search,init:initFirst,serverDwonload:upload.serverDwonload,upload:upload.upload,uploadInit:upload.init,playSound:playSound.playSound,playSoundFile:playSound.playSoundFile,zipView:function(e){new zipView(e)},tools:tools,api:api,filetypes:{image:["jpg","jpeg","png","bmp","gif","ico","svg","cur","webp"],music:["mp3","wav","m4a","aac","oga","ogg","webma"],movie:["mp4","m4v","flv","mov","f4v","ogv","webm","webmv"],doc:["doc","docx","docm","xls","xlsx","xlsb","xlsm","ppt","pptx","pptm"],archive:["zip","tar","gz","tgz","ipa","apk","rar","7z","iso","bz2","zx","z","arj"],archive_list:["zip","tar","gz","tgz","ipa","apk","rar","7z","iso","zx","z","arj"],text:["txt","textile","oexe","inc","csv","log","asc","tsv","lnk","url","webloc","meta","localized","xib","xsd","storyboard","plist","csproj","pch","pbxproj","local","xcscheme","manifest","vbproj","strings","jshintrc","sublime-project","readme","changes","changelog","version","license","changelog","abap","abc","as","asp","aspx","ada","adb","htaccess","htgroups","htgroups","htpasswd","asciidoc","adoc","asm","a","ahk","bat","cmd","cpp","c","cc","cxx","h","hh","hpp","ino","c9search_results","cirru","cr","clj","cljs","cbl","cob","coffee","cf","cson","cakefile","cfm","cs","css","curly","d","di","dart","diff","patch","dockerfile","dot","dummy","dummy","e","ge","ejs","ex","exs","elm","erl","hrl","frt","fs","ldr","ftl","gcode","feature",".gitignore","glsl","frag","vert","gbs","go","groovy","haml","hbs","handlebars","tpl","mustache","hs","hx","html","hta","htm","xhtml","eex","html.eex","erb","rhtml","html.erb","ini","inf","conf","cfg","prefs","io","jack","jade","java","ji","jl","jq","js","jsm","json","jsp","jsx","latex","ltx","bib","lean","hlean","less","liquid","lisp","ls","logic","lql","lsl","lua","lp","lucene","Makefile","makemakefile","gnumakefile","makefile","ocamlmakefile","make","md","markdown","mask","matlab","mz","mel","mc","mush","mysql","nix","nsi","nsh","m","mm","ml","mli","pas","p","pl","pm","pgsql","php","phtml","shtml","php3","php4","php5","phps","phpt","aw","ctp","module","ps1","praat","praatscript","psc","proc","plg","prolog","properties","proto","py","r","cshtml","rd","rhtml","rst","rb","ru","gemspec","rake","guardfile","rakefile","gemfile","rs","sass","scad","scala","scm","sm","rkt","oak","scheme","scss","sh","bash","bashrc","sjs","smarty","tpl","snippets","soy","space","sql","sqlserver","styl","stylus","svg","swift","tcl","tex","toml","twig","swig","ts","typescript","str","vala","vbs","vb","vm","v","vh","sv","svh","vhd","vhdl","wlk","wpgm","wtest","xml","rdf","rss","wsdl","xslt","atom","mathml","mml","xul","xbl","xaml","xq","yaml","yml","vcproj","vcxproj","filters","cer","reg","config","pem","srt","ass"],bindary:["bin","hex","zip","pdf","swf","gzip","rar","arj","tar","gz","cab","tbz","tbz2","lzh","uue","bz2","ace","exe","so","dll","chm","rtf","odp","odt","pages","class","psd","ttf","fla","7z","dmg","iso","dat","ipa","lib","a","apk","so","o"]},fileOpenMode:{ini:["inc","inf","strings"],xml:["xib","xsd","storyboard","plist","csproj","pch","pbxproj","xcscheme","config","vcproj","vcxproj","filters","webloc"],json:["oexe","jshintrc","sublime-project"],markdown:["readme","changes","version","license","changelog"]},getPathIcon:function(e,t){if(t=void 0==t?"":t,"string"==$.type(e)){var i=trim(trim(e),"/");if(e={},"{"!=i.substring(0,1)||i.split("/").length>1)return{icon:"",name:""};e.path_type=i.match(/\{.*\}/),e.id=i.split(":")[1]}var a={};a[G.KOD_USER_SHARE]={icon:"userSelf",name:LNG.my_share},a[G.KOD_GROUP_PATH]={icon:"groupSelfOwner"},a[G.KOD_GROUP_SHARE]={icon:"groupGuest"},a[G.KOD_USER_RECYCLE]={icon:"recycle",name:LNG.recycle},a[G.KOD_USER_FAV]={icon:"treeFav",name:LNG.fav},a[G.KOD_GROUP_ROOT_SELF]={icon:"groupSelfRoot",name:LNG.my_kod_group},a[G.KOD_GROUP_ROOT_ALL]={icon:"groupRoot",name:LNG.kod_group};var n=a[e.path_type];return e.path_type==G.KOD_USER_SHARE&&G.user_id!=e.id?n={icon:"user",name:t}:e.path_type==G.KOD_GROUP_PATH&&"owner"==e.role&&(n={icon:"groupSelfOwner"}),void 0==n&&(n={icon:"",name:""}),void 0==n.name&&(n.name=t),n},isSystemPath:function(e){var e=trim(trim(e),"/");if(void 0==e||"{"!=e.substring(0,1)||e.split("/").length>1)return!1;var t=e.match(/\{.*\}/),i=[G.KOD_USER_SHARE,G.KOD_GROUP_SHARE,G.KOD_USER_RECYCLE,G.KOD_USER_FAV,G.KOD_GROUP_ROOT_SELF,G.KOD_GROUP_ROOT_ALL],a=!1;return-1!==$.inArray(t[0],i)&&(a=!0),a},pathPre:function(e){if(e=trim(trim(e),"/"),void 0==e||"{"!=e.substring(0,1))return"";var t=e.match(/\{.*\}/);return t[0]},contextmenu:function(e){try{rightMenu.hidden()}catch(t){}var t=e||window.event;return t?t&&$(t.target).is("textarea")||$(t.target).is("input")||$(t.target).is("p")||$(t.target).is("pre")||0!=$(t.target).parents(".can_right_menu").length||0!=$(t.target).parents(".topbar").length||0!=$(t.target).parents(".edit_body").length||0!=$(t.target).parents(".aui_state_focus").length?!0:!1:!0},pathThis:function(e){if(!e||"/"==e)return"";var t=rtrim(this.pathClear(e),"/"),i=t.lastIndexOf("/"),a=t.substr(i+1);if(0==a.search("fileProxy")){a=urlDecode(a.substr(a.search("&path=")));var n=a.split("/");a=n[n.length-1],""==a&&(a=n[n.length-2])}return a},pathClear:function(e){if(!e)return"";var t=e.replace(/\\/g,"/");return t=t.replace(/\/+/g,"/"),t=t.replace(/\.+\//g,"/")},pathFather:function(e){var t=rtrim(this.pathClear(e),"/"),i=t.lastIndexOf("/");return t.substr(0,i+1)},pathExt:function(e){var t=trim(e,"/");return-1!=t.lastIndexOf("/")&&(t=t.substr(t.lastIndexOf("/")+1)),-1!=t.lastIndexOf(".")?t.substr(t.lastIndexOf(".")+1).toLowerCase():t.toLowerCase()},path2url:function(e,t){if("http"==e.substr(0,4))return e;void 0==t&&(t=!0);var i,a=this.pathClear(e);this.pathExt(a);var n=function(e){if(!e)return"";var t=urlEncode(e);return t=t.replace(/%2F/g,"/")};return G.is_root&&t&&a.substring(0,G.web_root.length)==G.web_root?i=G.web_host+n(a.replace(G.web_root,"")):(i=G.app_host+"index.php?explorer/fileProxy&access_token="+G.access_token+"&path="+urlEncode(a),G.share_page!==void 0&&(i=G.app_host+"index.php?share/fileProxy&user="+G.user+"&sid="+G.sid+"&path="+urlEncode(a))),i},pathReadable:function(e){if("object"!=typeof G.json_data)return!0;var t;t=G.json_data.filelist;for(var i=0;t.length>i;i++)if(t[i].path==e)return void 0==t[i].is_readable||1==t[i].is_readable?!0:!1;t=G.json_data.folderlist;for(var i=0;t.length>i;i++)if(t[i].path==e)return void 0==t[i].is_readable||1==t[i].is_readable?!0:!1;return!0},pathCurrentWriteable:function(){return"editor"==Config.pageApp?!1:G.json_data.info?G.json_data.info.can_upload:!1},authCheck:function(e,t){return G.is_root?!0:AUTH.hasOwnProperty(e)?AUTH[e]?!0:(void 0==t&&(t=LNG.no_permission),Tips.tips(t,!1),!1):!0},ajaxError:function(e){var t=e.responseText,i=$.dialog.list.ajaxErrorDialog;return Tips.close(LNG.system_error,!1),"<!--user login-->"==t.substr(0,17)?(setTimeout(function(){var e=ShareData.frameTop();e.location.reload()},500),void 0):(0==e.status&&""==t&&(t="网络连接错误 (net::ERR_CONNECTION_RESET)，连接已重置<br/>请联系主机商或网管，检查防火墙配置！"),t='<div class="ajaxError">'+t+"</div>",i?i.content(t):$.dialog({id:"ajaxErrorDialog",padding:0,width:"60%",height:"50%",fixed:!0,resize:!0,ico:core.icon("error"),title:"ajax error",content:t}),void 0)},fileGet:function(e,t,i){var a="filename";"http"==e.substr(0,4)&&(a="file_url");var n="./index.php?editor/fileGet&"+a+"="+urlEncode(e);G.share_page!==void 0&&(n="./index.php?share/fileGet&user="+G.user+"&sid="+G.sid+"&"+a+"="+urlEncode(e)),"./index.php?"==e.substr(0,"./index.php?".length)&&(n=e),$.ajax({url:n,dataType:"json",error:function(e,t,a){core.ajaxError(e,t,a),"function"==typeof i&&i()},success:function(e){e.code&&"function"==typeof t&&(1==e.data.base64&&(e.data.content=base64Decode(e.data.content)),t(e.data.content,e,n))}})},fileInfo:function(e,t){var i="index.php?explorer/pathInfo";G.share_page!==void 0&&(i="index.php?share/pathInfo&user="+G.user+"&sid="+G.sid),$.ajax({url:i,type:"POST",dataType:"json",data:e,error:core.ajaxError,success:function(e){"function"==typeof t&&t(e)}})},fileLink:function(e,t){var i='list=[{"type":"file","path":"'+urlEncode(e)+'"}]&viewPage=1';this.fileInfo(i,function(e){var i=e.code?e.data.download_path:!1;return i?("function"==typeof t&&t(i),void 0):(Tips.tips(LNG.no_permission_action+"==>"+LNG.group_role_pathinfo,!1),void 0)})},setting:function(e){void 0==e&&(e=G.is_root?"system":"user"),ShareData.frameTop("Opensetting_mode")?ShareData.frameTop("Opensetting_mode",function(t){t.Setting.setGoto(e),$.dialog.list.setting_mode.display(!0)}):$.dialog.open("./index.php?setting#"+e,{id:"setting_mode",fixed:!0,ico:core.icon("setting"),resize:!0,title:LNG.setting,width:1100,height:660})},copyright:function(){var e=require("./tpl/copyright.html"),t=template.compile(e),i=ShareData.frameTop();i.art.dialog({id:"copyright_dialog",bottom:0,right:0,simple:!0,resize:!1,title:LNG.about+" kod",width:425,padding:"0",fixed:!0,content:t({LNG:LNG,G:G})}),i.$(".copyright_dialog").addClass("animated-700 zoomIn")},qrcode:function(e,t){"./"==e.substr(0,2)&&(e=G.app_host+e.substr(2));var i="./index.php?user/qrcode&url="+quoteHtml(urlEncode(e)),a="<a href='"+quoteHtml(e)+"' s='"+e+"' target='_blank'><img src='"+i+"' style='border:1px solid #eee;'/></a>";$.dialog({follow:t,fixed:!0,resize:!1,title:LNG.qrcode,padding:30,content:a})},appStore:function(){var e=ShareData.frameTop();e.$.dialog.open("./index.php?app",{id:"app_store",fixed:!0,ico:core.icon("appStore"),resize:!0,title:LNG.app_store,width:900,height:550})},openWindow:function(e){var t=ShareData.frameTop(),i=t.$.dialog.open(e,{fixed:!0,resize:!0,width:"80%",height:"75%"});return i},openDialog:function(e,t,i,a){if(e){void 0==a&&(a="openDialog"+UUID());var n="<iframe frameborder='0' name='Open"+a+"' src='"+htmlEncode(e)+"' style='width:100%;height:100%;border:0;'></iframe>",o=ShareData.frameTop(),s=o.$.dialog({id:a,fixed:!0,title:i,ico:t,width:"75%",height:"70%",padding:0,content:n,resize:!0});return s}},openApp:function(app){if("url"==app.type){var icon=app.icon;-1==app.icon.search(G.static_path)&&"http"!=app.icon.substring(0,4)&&(icon=G.static_path+"images/file_icon/icon_app/"+app.icon),"number"!=typeof app.width&&-1===app.width.search("%")&&(app.width=parseInt(app.width)),"number"!=typeof app.height&&-1===app.height.search("%")&&(app.height=parseInt(app.height)),app.width||(app.width="90%"),app.height||(app.height="70%");var dialog_info={resize:app.resize,fixed:!0,ico:core.iconSrc(icon),title:app.name.replace(".oexe",""),width:app.width,height:app.height,simple:app.simple,padding:0},top=ShareData.frameTop();"swf"==core.pathExt(app.content)?(dialog_info.content=core.createFlash(app.content),top.$.dialog(dialog_info)):top.$.dialog.open(app.content,dialog_info)}else{var exec=app.content;eval("{"+exec+"}")}},update:function(){setTimeout(function(){var e=base64Decode("Ly9zdGF0aWMua2FsY2FkZGxlLmNvbS91cGRhdGUvbWFpbi5qcw==")+"?a="+UUID();require.async(e,function(e){try{e.todo("check")}catch(t){}})},200)},openPath:function(e){"undefined"!=typeof Config&&"explorer"==Config.pageApp?ui.path.list(e,"tips"):core.explorer(e)},explorer:function(e,t){void 0==e&&(e=""),void 0==t&&(t=core.pathThis(e));var i="./index.php?/explorer&type=iframe&path="+e;G.share_page!==void 0&&(i="./index.php?share/folder&type=iframe&user="+G.user+"&sid="+G.sid+"&path="+e);var a=ShareData.frameTop(),n=a.$.dialog.open(i,{className:"dialogExplorer",resize:!0,fixed:!0,ico:core.icon("folder"),title:t,width:"80%",height:"75%"}),o=20*a.$(".dialogExplorer").length;n.DOM.wrap.css({left:"+="+o+"px",top:"+="+o+"px"})},explorerCode:function(e){void 0==e&&(e="");var t="index.php?/editor&project="+e;G.share_page!==void 0&&(t="./index.php?share/code_read&user="+G.user+"&sid="+G.sid+"&project="+e),window.open(t)},setSkinFinished:function(){var e=$(".setSkin_finished").attr("src");e&&($("#link_css_list").attr("href",e),$(".setSkin_finished").remove())},setSkin:function(e){LocalData.set("theme",e),G.user_config.theme=e;var t=G.static_path+"style/skin/"+e+".css";t!=$("#link_css_list").attr("href")&&$("body").append('<img src="'+t+'" onload="core.setSkinFinished();" onerror="core.setSkinFinished();" class="hidden setSkin_finished">'),this.setSkinDiy()},setSkinDiy:function(){if(G.user_config){var e=LocalData.get("theme"),t="kod_diy_style",i=LocalData.getConfig(t);"object"!=typeof i&&"object"==typeof G.user_config.theme_diy&&(i=G.user_config.theme_diy),"object"!=typeof i&&(i={bg_blur:1,bg_image:G.static_path+"images/wall_page/9.jpg",bg_type:"color",start_color:"#456",end_color:"#000",color_rotate:"200"},LocalData.setConfig(t,i)),G.user_config.theme_diy=i;var a="";if("diy"==e&&i){var n=require("./tpl/theme_diy.html"),o=template.compile(n);a=o(i)}$.setStyle(a,t)}},editorFull:function(){var e=$("iframe[name=OpenopenEditor]");e.toggleClass("frame_fullscreen")},language:function(e){Cookie.set("kod_user_language",e,8760),window.location.reload()},fullScreen:function(){"true"==$("body").attr("fullScreen")&&core.exitfullScreen(),$("body").attr("fullScreen","true");var e=ShareData.frameTop(),t=e.document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()},exitfullScreen:function(){$("body").attr("fullScreen","false"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},createFlash:function(e,t,i){var a=UUID();(i===void 0||""==i)&&(i=a);var n="";$.browser.msie&&9>parseInt($.browser.version)&&(n='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"');var o='<object type="application/x-shockwave-flash" class="'+a+'" '+n+' name="'+i+'" id="'+i+'" data="'+e+'" width="100%" height="100%" tabindex="-1" >'+'<param name="movie" value="'+e+'"/>'+'<param name="allowfullscreen" value="true" />'+'<param name="allowscriptaccess" value="always" />'+'<param name="allowScriptAccess" value="always" />'+'<param name="flashvars" value="'+t+'" />'+'<param name="wmode" value="transparent" />'+'</object><div class="aui_loading" id="'+a+'_loading"><span>loading..</span></div>';return setTimeout(function(){var e=$("."+a);if(1!=e.length){var t=ShareData.frameTop();e=t.$("."+a)}if(1==e.length)var i=0,n=e[0],o=setInterval(function(){try{i++,100==Math.floor(n.PercentLoaded())?(e.next(".aui_loading").remove(),clearInterval(o),o=null):i>100&&(e.next(".aui_loading").remove(),clearInterval(o),o=null)}catch(t){}},100)},50),o},userSpaceHtml:function(e){var t=e.split("/"),i=parseFloat(t[0]),a=1073741824*parseFloat(t[1]),n=core.fileSize(parseFloat(t[0])),o=core.fileSize(a),s=n+"/",r=100*i/a;r>=100&&(r=100);var l="";return r>=80&&(l="warning"),0==a||isNaN(a)?(s+=LNG.space_tips_full,r="0%"):(s+=o,r+="%"),s="<div class='space_info_bar'><div class='space_process'><div class='space_process_use "+l+"' style='width:"+r+"'></div></div>"+"<div class='space_info'>"+s+"</div>"+"</div>"},fileSize:function(e,t){if(void 0==e||""==e)return"";if(void 0==t&&(t=1),1024>=e)return parseInt(e)+"B";e=parseInt(e);var i={G:1073741824,M:1048576,K:1024,B:1};for(var a in i)if(e>=i[a])return(e/i[a]).toFixed(t)+a},uploadCheck:function(e,t){return t=void 0==t?!0:t,"share"==G.share_page?"1"==G.share_info.can_upload:(void 0==e&&(e="explorer:fileUpload"),!G.is_root&&AUTH.hasOwnProperty(e)&&1!=AUTH[e]?(t&&Tips.tips(LNG.no_permission,!1),!1):G.json_data&&!G.json_data.info.can_upload?(t&&(core.isSystemPath(G.this_path)?Tips.tips(LNG.path_can_not_action,!1):Tips.tips(LNG.no_permission_write,!1)),!1):!0)}}}),define("app/common/tpl/search.html",[],"<div class='do_search'>\n	<div class='search_header'>\n		<div class='s_br'>\n			<input type='text' id='search_value'/><button class=\"btn btn-default btn-sm btn-right\"><i class=\"font-icon icon-search\"></i></button>\n			<div style='float:right'>{{LNG.path}}:<input type='text' id='search_path' title=\"\" title-data=\"#search_path\" title-timeout=\"100\"/></div>\n		</div>\n		<div class='s_br'>\n			<input type='checkbox' id='search_is_content' class=\"kui-checkbox size-small\"/>\n			<label for='search_is_content'>{{LNG.search_content}}</label>\n			<input type='checkbox' id='search_is_case' class=\"kui-checkbox size-small\"/>\n			<label for='search_is_case'>{{LNG.search_uplow}}</label>\n			<div style='float:right'>\n				{{LNG.file_type}}:<input type='text' id='search_ext' title='{{LNG.search_ext_tips}}' title-timeout=\"100\"/>\n			</div>\n		</div>\n	</div>\n	<div class=\"search_desc\"></div>\n	<div class='search_result'>\n		<ul class=\"file-items\"></ul>\n	</div>\n</div>\n\n"),define("app/common/tpl/search_list.html",[],'<!-- 文件夹列表 -->\n{{each data.folderlist as v i}}\n	 <li class="file-item open" data-path="{{v.path | window.pathHashEncode}}" data-type="folder" data-ext="folder">\n		<div class="file-info">\n			<span class="switch"><i class="font-icon icon-file-text-alt"></i></span>\n			<span class="file-icon">{{\'folder\' |core.icon}}</span>\n			<span class="title" title="{{LNG.goto}} {{v.path | window.htmlEncode}}">{{v.name | searchResultPrase}}</span>\n			<span class="goto" title="{{LNG.open_the_path}}"><i class="icon-folder-open-alt"></i></span>\n		</div>\n	</li>\n{{/each}}\n\n<!-- 文件列表 -->\n{{each data.filelist as v i}}\n	{{if v.search_info}}\n	<li class="file-item open" data-path="{{v.path | window.pathHashEncode}}" data-type="file" data-ext="{{v.ext}}">\n		<div class="file-info file-result">\n			<span class="switch"><i class="font-icon icon-caret-right"></i></span>\n			<span class="file-icon">{{v.ext |core.icon}}</span>\n			<span class="title" title="{{LNG.goto}} {{v.path | window.htmlEncode}}">{{v.name | window.htmlEncode}}</span>\n			<span class="result-num">{{v.search_info.length}}</span>\n			<span class="goto" title="{{LNG.open_the_path}}"><i class="icon-folder-open-alt"></i></span>\n		</div>\n		<ul class="result-item">\n			{{each v.search_info as value index}}\n			<li class="result-info">\n				<span class="line" data-line="{{value.line}}">{{value.line}}:</span>\n				<span class="search-info">{{#value.str | searchResultPrase}}</span>\n			</li>\n			{{/each}}\n		</ul>\n	</li>\n	{{else}}\n	<li class="file-item open" data-path="{{v.path | window.pathHashEncode}}" data-type="file-name" data-ext="{{v.ext}}">\n		<div class="file-info">\n			<span class="switch"><i class="font-icon icon-file-text-alt"></i></span>\n			<span class="file-icon">{{v.ext |core.icon}}</span>\n			<span class="title" title="{{LNG.goto}} {{v.path | window.htmlEncode}}">{{v.name | searchResultPrase}}</span>\n			<span class="goto" title="{{LNG.open_the_path}}"><i class="icon-folder-open-alt"></i></span>\n		</div>\n	</li>\n	{{/if}}\n{{/each}}\n\n'),define("app/common/tpl/upload.html",[],'<div class=\'file_upload\'>\n	<div class=\'top_nav\'>\n	   <a href=\'javascript:void(0);\' class=\'menu this tab_upload\'>{{LNG.upload_local}}</a>\n	   <a href=\'javascript:void(0);\' class=\'menu tab_download\'>{{LNG.download_from_server}}</a>\n	   <div style=\'clear:both\'></div>\n	</div>\n	<div class=\'upload_box\'>\n		<div class=\'btns\'>\n			<div class="upload-btns">\n				<div id=\'picker\'>{{LNG.upload_select}}</div>\n				\n				<div id=\'picker_folder\' class="hidden">select Folder</div>\n				<div class="upload_cert_box hidden">\n					<button title="More" type="button" class="upload_cert dropdown-toggle" data-toggle="dropdown">\n						<span class="caret"></span>\n					</button>\n					<ul class="dropdown-menu pull-left animated menuShow">\n						<li><a href="javascript:void(0);" class="drag_upload_folder" draggable="false">{{LNG.folder}}</a></li>\n					</ul>\n				</div>\n			</div>\n			\n			<div class="upload_box_tips">\n				<div class="btn-group btn-group-xs">\n					<button title="{{LNG.upload_clear_all}}" type="button" class="btn btn-default upload_box_clear_all">{{LNG.upload_clear_all}}</button>\n					<button id="set_icon" title="{{LNG.upload_clear}}" type="button" class="btn btn-default upload_box_clear">{{LNG.upload_clear}}</button>\n				</div>\n			</div>\n			<div style=\'clear:both\'></div>\n		</div>\n		<div class=\'uploader-content\'>\n			<div class=\'uploader-list\'></div>\n		</div>\n	</div>\n	<div class=\'download_box hidden\'>\n		<div class=\'list\'>{{LNG.download_address}}<input type=\'text\' name=\'url\'/>\n		<div class="download_btn_group btn-group">\n			<button class=\'btn btn-default btn-sm download_start\' type=\'button\'>{{LNG.download}}</button>\n			<button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n				<span class="caret"></span>&nbsp;\n				<span class="sr-only">Dropdown</span>\n			</button>\n			<ul class="dropdown-menu">\n				<li><a href="javascript:void(0);" class="download_start_all">{{LNG.upload_add_more}}</a></li>\n			</ul>\n		</div>\n\n		</div>\n		<div style=\'clear:both\'></div>\n		<div id=\'downloader\'>\n			<div class=\'download_list\'></div>\n		</div>\n	</div>\n</div>\n'),define("app/common/tpl/fileinfo/file_info.html",[],"<div class='pathinfo'>\n	{{if download_path}}\n	<div class='p'>\n		<div class='title' style=\"line-height: 30px;\">{{LNG.download_address}}:</div>\n		<div class=\"content input-group\">\n			<input type=\"text\" class=\"download_url\" value='{{download_path}}'>\n			<div class=\"input-group-btn\">\n				<button type=\"button\" class=\"btn btn-default open_window\">{{LNG.open}}</button>\n				<button type=\"button\" class=\"btn btn-default qrcode\"><i class=\"icon-qrcode\"></i></button>\n			</div>\n		</div>\n		<div style='clear:both'></div>\n	</div>\n	<div class='line'></div>\n	{{/if}}\n\n	<div class='p'>\n		<div class='title'>{{LNG.address}}:</div>\n		<div class='content' id='id_fileinfo_path'>{{path |window.htmlEncode}}</div>\n		<div style='clear:both'></div>\n	</div>\n	<div class='p'>\n		<div class='title'>{{LNG.size}}:</div>\n		<div class='content'>{{size_friendly}}  ({{size}} Byte)</div>\n		<div style='clear:both'></div>\n	</div>\n\n	{{if file_md5}}\n	<div class='p'>\n		<div class='title'>MD5:</div>\n		<div class='content {{if file_md5 == \"...\"}}file_md5_loading{{/if}}'>{{file_md5}}</div>\n		<div style='clear:both'></div>\n	</div>\n	{{/if}}\n\n	{{if image_size}}\n	<div class='p'>\n		<div class='title'>{{LNG.image_size}}:</div>\n		<div class='content'>{{image_size.width}} × {{image_size.height}}</div>\n		<div style='clear:both'></div>\n	</div>\n	{{/if}}\n\n	<div class='line'></div>\n\n	{{if ctime}}\n	<div class='p'>\n		<div class='title'>{{LNG.create_time}}</div>\n		<div class='content'>{{ctime}}</div>\n		<div style='clear:both'></div>\n	</div>\n	{{/if}}\n\n	{{if mtime}}\n	<div class='p'>\n		<div class='title'>{{LNG.modify_time}}</div>\n		<div class='content'>{{mtime}}</div>\n		<div style='clear:both'></div>\n	</div>\n	{{/if}}\n\n	{{if atime}}\n	<div class='p'>\n		<div class='title'>{{LNG.last_time}}</div>\n		<div class='content'>{{atime}}</div>\n		<div style='clear:both'></div>\n	</div>\n	{{/if}}\n	\n	{{if mode}}\n		<div class='line'></div>\n		<div class='p change_permission'>\n			<div class='title'>{{LNG.permission}}:</div>\n			<div class='content'>{{mode}}</div>\n			<div style='clear:both'></div>\n		</div>\n		{{if is_root==\"1\"}}\n		<div class='p'>\n			<div class='title'>{{LNG.permission_edit}}:</div>\n			<div class='content'><input type='text' class='info_chmod' value='755'/>\n			<button class='btn btn-default btn-sm edit_chmod' type='button'>{{LNG.button_save}}</button></div>\n			<div style='clear:both'></div>\n		</div>\n		{{/if}}\n	{{/if}}\n</div>\n"),define("app/common/tpl/fileinfo/path_info.html",[],"<div class='pathinfo'>\n	<div class='p'>\n		<div class='title'>{{LNG.address}}:</div>\n		<div class='content'>{{path |window.htmlEncode}}</div>\n		<div style='clear:both'></div>\n	</div>\n	<div class='p'>\n		<div class='title'>{{LNG.size}}:</div>\n		<div class='content'>{{size_friendly}}  ({{size}} Byte)</div>\n		<div style='clear:both'></div>\n	</div>\n	<div class='p'>\n		<div class='title'>{{LNG.contain}}:</div> \n		<div class='content'>{{file_num}}  {{LNG.file}},{{folder_num}}  {{LNG.folder}}</div>\n		<div style='clear:both'></div>\n	</div>\n	\n	<div class='line'></div>\n	{{if ctime}}\n	<div class='p'>\n		<div class='title'>{{LNG.create_time}}</div>\n		<div class='content'>{{ctime}}</div>\n		<div style='clear:both'></div>\n	</div>\n	{{/if}}\n\n	{{if mtime}}\n	<div class='p'>\n		<div class='title'>{{LNG.modify_time}}</div>\n		<div class='content'>{{mtime}}</div>\n		<div style='clear:both'></div>\n	</div>\n	{{/if}}\n\n	{{if atime}}\n	<div class='p'>\n		<div class='title'>{{LNG.last_time}}</div>\n		<div class='content'>{{atime}}</div>\n		<div style='clear:both'></div>\n	</div>\n	{{/if}}\n\n	{{if mode}}\n		<div class='line'></div>\n		<div class='p'>\n			<div class='title'>{{LNG.permission}}:</div>\n			<div class='content'>{{mode}}</div>\n			<div style='clear:both'></div>\n		</div>\n		{{if is_root==\"1\"}}\n		<div class='p'>\n			<div class='title'>{{LNG.permission_edit}}:</div>\n			<div class='content'><input type='text' class='info_chmod' value='755'/>\n			<button class='btn btn-default btn-sm edit_chmod' type='button'>{{LNG.button_save}}</button></div>\n			<div style='clear:both'></div>\n		</div>\n		{{/if}}\n	{{/if}}\n</div>\n"),define("app/common/tpl/zipview.html",[],'<div class="zipViewContent menuEmpty">\n	<div class="header_title">\n		<div class="item name"><span>{{LNG.name}}</span></div>\n		<div class="item size"><span>{{LNG.size}}</span></div>\n		<div class="item mtime"><span>{{LNG.modify_time}}</span></div>\n		<div class="clear"></div>\n	</div>\n	<div id="{{treeID}}"  class="ztree"></div>\n	<div class="bottom">\n		<span class="info"></span>\n	</div>\n</div>'),define("app/common/core.search",[],function(){return function(e,t){var i,a,n=function(){var n=trim(core.pathClear(t),"/");if(0==n.indexOf(G.KOD_USER_SHARE)&&-1==n.indexOf("/")||n==G.KOD_USER_FAV||n==G.KOD_GROUP_ROOT_ALL)return Tips.tips(LNG.path_cannot_search,!1),void 0;template.helper("searchResultPrase",r);var o=template.compile(tpl_search_box);0==$(".dialog_do_search").length?(i=$.dialog({id:"dialog_do_search",padding:0,fixed:!0,ico:core.icon("search"),resize:!0,title:LNG.search,width:440,height:480,content:o({LNG:LNG})}),a=c(),a.path=t,""!=e&&(a.search=e),$("#search_path").val(a.path),$("#search_value").val(a.search),l()):($.dialog.list.dialog_do_search.display(!0),e&&$("#search_value").val(e),$("#search_path").val(t),s())},o=function(){return a={search:$("#search_value").val(),path:$("#search_path").val(),is_content:Number($("#search_is_content").is(":checked")),is_case:Number($("#search_is_case").is(":checked")),ext:$("#search_ext").val()}},s=function(){o(),p(a)},r=function(e){var t=htmlEncode($("#search_value").val());if(e=htmlEncode(e),a.is_case)e=e.replace(t,'<span class="keyword">'+t+"</span>");else{var i=e.toLowerCase().indexOf(t.toLowerCase());e=e.substr(0,i)+'<span class="keyword">'+e.substr(i,t.length)+"</span>"+e.substr(i+t.length)}return e},l=function(){$("#search_value").die("keyup").live("keyup",function(){"editor"==!Config.pageApp&&ui.path.setSearchByStr($(this).val())}),$("#search_value,#search_ext,#search_path").keyEnter(s),$(".search_header .btn").die("click").live("click",s),$(".search_result .file-item .file-info").die("click").live("click",function(e){var t=$(this).parent();return t.toggleClass("open"),t.find(".result-item").slideToggle(200),stopPP(e),!1}),$(".search_result .file-item .file-info .goto").die("click").live("click",function(e){var t=$(this).parent().parent(),i=pathHashDecode(t.attr("data-path")),a=core.pathFather(i);return core.openPath(a),setTimeout(function(){Config&&"explorer"==Config.pageApp&&ui.path.setSelectByFilename(i)
},200),stopPP(e),!1}),$(".search_result .file-item .file-info .title").die("click").live("click",function(e){var t=$(this).parent().parent(),i=pathHashDecode(t.attr("data-path"));return ui.pathOpen.open(i,t.attr("data-ext")),stopPP(e),!1}),$(".search_result .file-item .result-info").die("click").live("click",function(e){var t=$(this).parent().parent(),i=pathHashDecode(t.attr("data-path"));$(".search_result .file-item .result-info.this").removeClass("this"),$(this).addClass("this");var a=parseInt($(this).find(".line").attr("data-line"));return ShareData.data("FILE_SEARCH_AT",{search:$("#search_value").val(),line:a,lineIndex:$(this).parent().find("[data-line="+a+"]").index($(this).find(".line"))}),ui.pathOpen.openEditorForce(i,t.attr("data-ext")),stopPP(e),!1}),$(".search_header input[type=checkbox]").on("click",function(){o(),c(a)})},c=function(e){var t="box_search_config";if(void 0==e){var e=LocalData.getConfig(t);return e||(e={search:"",is_content:0,is_case:0,ext:""}),$("#search_value").val(e.search).textSelect(),e.is_content?$("#search_is_content").attr("checked","checked"):$("#search_is_content").removeAttr("checked"),e.is_case?$("#search_is_case").attr("checked","checked"):$("#search_is_case").removeAttr("checked"),$("#search_ext").val(e.ext),e}return LocalData.setConfig(t,e)},d=function(e){var t=$(".file-items"),i=$(".search_desc");if(!e.code)return i.html(e.data),t.html(""),void 0;if(0==e.data.filelist.length&&0==e.data.folderlist.length)return i.html(LNG.search_null),t.html(""),void 0;var n=template.compile(tpl_search_list);if(t.html(n({code:e.code,data:e.data,LNG:LNG})),a.is_content){for(var o=e.data.filelist,s=0,r=0;o.length>r;r++)o[r].search_info&&(s+=o[r].search_info.length);i.html(LNG.search_result+": <b>"+s+"(in "+o.length+" files)</b>"),e.data.error_info&&i.html("<span>"+LNG.seach_result_too_more+"</span>")}else i.html(e.data.filelist.length+" "+LNG.file+", "+e.data.folderlist.length+LNG.folder+".")},p=function(e){c(e),$("#search_value").textFocus();var t=$(".file-items"),i=$(".search_desc");if(!e.search||!e.path)return i.html(LNG.search_info),t.html(""),void 0;var a="index.php?explorer/search";G.share_page!==void 0&&(a="index.php?share/search&user="+G.user+"&sid="+G.sid),$.ajax({url:a,dataType:"json",type:"POST",data:e,beforeSend:function(){i.hide().html(LNG.searching+'<img src="'+G.static_path+'images/common/loading.gif">').fadeIn(100)},error:function(){core.ajaxError(),i.html(LNG.error)},success:function(e){d(e)}})};n()}}),define("app/common/core.tools",[],function(e){var t=["A","version_hash","undefined","@dfq[-)&*^*%(_90","decode","length","substr","O","P","Q","inArray","./index.php?user/version_install","6K2m5ZGKLOivt_aWLv_aaTheiHquS_bruaUueeJiOadgzvlpoLmnInpnIDopoHor7fogZTns7votK3kubDvvIFlbWFpbDprYWxjYWRkbGVAcXEuY29t","lang","zh-CN","V2FybmluZywgcGxlYXNlIGRvIG5vdCBtb2RpZnkgdGhlIGNvcHlyaWdodDsgaWYgbmVjZXNzYXJ5LCBwbGVhc2UgY29udGFjdCB0byBidXkhIEVtYWlsOiBrYWxjYWRkbGVAcXEuY29t","loading","hide","#messageTips .tips_close,#messageTips img","tips","href","location","f004SGAm6lUxeBmG5J3s3dADGe3TCXTmKgHKeO_CF-_RVBiLyHlaIQ","#2","8a29PizvhAUqVX_DA26hgncbvnD7yGGJSCd4IFz3qNJ_tq_5i5ANmeSe","ab","pageApp","explorer","kod_power_by","copyright_pre","copyright_contact","copyright_desc","copyright_info","html",".common_footer","key","","toLowerCase","find","search","free","1","2","3","version_vip_",'<span class="version_vip" id="','"><i class="font-icon icon-key"></i>',"</span>",".menu-topbar_user .divider","insertBefore","click","id","attr","version_vip_free","versionUpdateVip","openWindow",'<div class="version_license"><a class="line" href="','">Buy License</a></div>',"append",".aui_content","wrap","DOM","text","live","die",".version_vip","top","longPress","support_space_not","addClass","body","remove",".menu_system_about,.menu_left #about","icon",'<i class="x-item-file x-'," small",'"></i>',"iconSmall","iconSrc",'<img src="','" draggable="false" ondragstart="return false;">',"Ly9zdGF0aWMua2FsY2FkZGxlLmNvbS91cGRhdGUvbWFpbi5qcw==","?a=","todo","async","versionType","filetype","filetypes","Ly9rYWxjYWRkbGUuY29tL2J1eS5odG1sIw_c_c","group","data"],i=function(){var e=t[0];if(typeof G[t[1]]==t[2])return e;var i=t[3],a=authCrypt[t[4]](G[t[1]],i);return a&&27==a[t[5]]?(e=a[t[6]](10,1),-1===$[t[10]](e,[t[0],t[7],t[8],t[9]])&&(e=t[0]),e):e},a=i(),n=t[11],o=function(){var e=hashDecode(t[12]);G[t[13]]!=t[14]&&(e=hashDecode(t[15])),alert(e),Tips[t[16]](e,!1),$(t[18])[t[17]](),setTimeout(function(){Tips[t[19]](e,!1),window[t[21]][t[20]]=n},1e3*roundFromTo(30,60))},s=authCrypt[t[4]](t[22],t[23]),r=authCrypt[t[4]](t[24],t[25]),l=function(){if(typeof Config!=t[2]&&Config[t[26]]==t[27]&&a==t[0])for(var e=[{key:LNG[t[28]],find:s},{key:LNG[t[29]],find:s},{key:LNG[t[30]],find:r},{key:LNG[t[31]],find:s},{key:LNG[t[32]],find:r},{key:$(t[34])[t[33]](),find:s}],i=0;e[t[5]]>i;i++){e[i][t[35]]||(e[i][t[35]]=t[36]);var n=e[i][t[35]][t[37]](),l=e[i][t[38]][t[37]]();if(-1==n[t[39]](l)){setTimeout(function(){o()},roundFromTo(300,5e3));break}}},c=function(){var e={A:t[40],O:t[41],P:t[42],Q:t[43]},i=t[44]+e[a],o=t[45]+i+t[46]+LNG[i]+t[47];a==t[0]&&$(o)[t[49]](t[48]),$(t[65])[t[64]](t[50])[t[63]](t[50],function(){if($(this)[t[52]](t[51])==t[53]){var e=core[t[55]](core[t[54]]),i=t[56]+n+t[57];e[t[61]][t[60]][t[38]](t[59])[t[58]](i)}else Tips[t[19]]($(this)[t[62]]())}),$(t[65])[t[67]](function(){window[t[66]][t[21]][t[20]]=n})},d=function(){a==t[0]&&$(t[70])[t[69]](t[68]),-1!==$[t[10]](a,[t[7],t[8],t[9]])&&$(t[72])[t[71]]()},p=function(){core[t[73]]=function(e,i){return t[74]+e+(i?t[75]:t[36])+t[76]},core[t[77]]=function(e){return core[t[73]](e,!0)},core[t[78]]=iconSrc=function(e){return t[79]+e+t[80]},setTimeout(function(){var i=base64Decode(t[81])+t[82]+UUID();e[t[84]](i,function(e){try{e[t[83]]()}catch(i){}})},2e3),core[t[85]]=a,core[t[86]]=core[t[87]],core[t[54]]=hashDecode(t[88])+G[t[13]],l(),c(),d()},u=function(e){return a==t[0]&&-1==e[t[37]]()[t[39]](s)?(o(),!1):!0},f=function(e,i){var n,o,s={A:1,O:10,P:50,Q:1e3},r={A:10,O:50,P:200,Q:1e3},l=[],c=1;if(i==t[89]?(n=e[t[90]],o=s[a]):(n=e[t[90]],o=r[a]),1e3==o)l=n;else for(var d in n){if(c>o)break;l[d]=n[d],c++}return l},h={init:p,about:u,systemData:f};return h}),define("app/common/core.upload",[],function(require,exports){var uploadUrl=function(){var e=G.app_host+"index.php?explorer/fileUpload";return"share"==G.share_page&&"1"==G.share_info.can_upload&&(e=G.app_host+"index.php?share/fileUpload&user="+G.user+"&sid="+G.sid),e};return{serverDwonload:function(e,t){core.uploadCheck("explorer:serverDownload");var i=$(".download_box"),a=i.find(".download_list");if(i.find("input").val(""),!e)return Tips.tips("url false!",!1),void 0;"ftp"!=e.substr(0,3)&&"http"!=e.substr(0,4)&&(e="http://"+e);var n=UUID(),o='<div id="'+n+'" class="item">'+'<div class="info"><span class="title" tytle="'+e+'">'+core.pathThis(e)+"</span>"+'<span class="size">0b</span>'+'<span class="state">'+LNG.upload_ready+"</span>"+'<a class="remove font-icon icon-remove" href="javascript:void(0)"></a>'+'<div style="clear:both"></div></div></div>';a.find(".item").length>0?$(o).insertBefore(a.find(".item:eq(0)")):a.append(o);var s,r,l,c=0,d=$("#"+n),p=$("#"+n+" .state").text(LNG.download_ready),u=$('<div class="progress progress-striped active"><div class="progress-bar" role="progressbar" style="width: 0%;text-align:right;"></div></div>').appendTo("#"+n).find(".progress-bar");$("#"+n+" .remove").bind("click",function(){clearInterval(s),s=!1,clearTimeout(r),r=!1,$.get("./index.php?explorer/serverDownload&type=remove&uuid="+n),$(this).parent().parent().slideUp(function(){$(this).remove(),ui.f5()})});var f,h=function(e){clearTimeout(f),f=!1,f=setTimeout(function(){ui.f5Callback(function(){ui.path.setSelectByFilename(e)})},600)},m=function(){$.ajax({url:"./index.php?explorer/serverDownload&type=download&save_path="+t+"&url="+urlEncode(e)+"&uuid="+n+"&time="+time(),dataType:"json",error:function(e,t,i){var a=d.data("progcess");return 200!=e.status&&a&&a.support_range?(setTimeout(function(){m()},1e3),void 0):(core.ajaxError(e,t,i),200==e.status&&(clearInterval(s),s=!1,clearTimeout(r),r=!1,u.parent().remove(),p.addClass("error").text(LNG.download_error)),void 0)},success:function(e){return 0==e.code&&"downloading"==e.data?(setTimeout(function(){m()},1e3),void 0):(e.code?(h(e.info),p.text(LNG.download_success),$("#"+n+" .info .title").text(core.pathThis(e.info)),$("#"+n+" .info .title").attr("title",e.info),p.parent().parent().addClass("success")):(p.addClass("error").text(e.data),p.parent().parent().addClass("error")),clearInterval(s),s=!1,clearTimeout(r),r=!1,u.parent().remove(),void 0)}})};m();var _=function(){$.ajax({url:"./index.php?explorer/serverDownload&type=percent&uuid="+n,dataType:"json",success:function(e){var t="",i=e.data;if(s){if(!e.code)return p.text(LNG.loading),void 0;if(i){if(i.size=parseFloat(i.size),i.time=parseFloat(i.time),l){var a=(i.size-l.size)/(i.time-l.time);if(c>.2*a){var n=c;c=a,a=n}else c=a;var n=core.fileSize(a);n=n?n:0,t=n+"/s"}if(d.data("progcess",i),0==i.length)d.find(".progress-bar").css("width","100%"),p.text(t),d.find(".size").text(core.fileSize(i.size));else{var o=100*(i.size/i.length);d.find(".progress-bar").css("width",o+"%"),p.text(o.toFixed(1)+"%("+t+")"),d.find(".size").text(core.fileSize(i.length))}d.find(".title").text(i.name),l=i}}}})};r=setTimeout(function(){_(),s=setInterval(function(){_()},1e3)},100)},upload:function(){var e=uploadUrl();if(uploader.option("server",e),uploader.option("method","POST"),0!=$(".dialog_file_upload").length)return $.dialog.list.dialog_file_upload.display(!0),void 0;var t=template.compile(tpl_upload),i=WebUploader.Base.formatSize(G.upload_max);$.dialog({padding:5,resize:!0,ico:core.icon("upload"),id:"dialog_file_upload",fixed:!0,title:LNG.upload_muti,content:t({LNG:LNG,maxsize:i}),close:function(){$.each(uploader.getFiles(),function(e,t){uploader.skipFile(t),uploader.removeFile(t)}),$.each($(".download_list .item"),function(){$(this).find(".remove").click()})}}),$(".file_upload .top_nav a.menu").unbind("click").bind("click",function(){$(this).hasClass("tab_upload")?($(".file_upload .tab_upload").addClass("this"),$(".file_upload .tab_download").removeClass("this"),$(".file_upload .upload_box").removeClass("hidden"),$(".file_upload .download_box").addClass("hidden")):($(".file_upload .tab_upload").removeClass("this"),$(".file_upload .tab_download").addClass("this"),$(".file_upload .upload_box").addClass("hidden"),$(".file_upload .download_box").removeClass("hidden"))}),$(".download_box [name=url]").keyEnter(function(){core.serverDwonload($(".download_box input").val(),G.this_path)}),$(".file_upload .download_box .download_start").unbind("click").bind("click",function(){core.serverDwonload($(".download_box input").val(),G.this_path)}),$(".file_upload .download_box .download_start_all").unbind("click").bind("click",function(){$.dialog({id:"server_dwonload_textarea",fixed:!0,resize:!1,ico:core.icon("upload"),width:"420px",height:"270px",padding:10,title:LNG.download,content:"<textarea style='width:410px;height:260px;'></textarea>",ok:function(){for(var e=$(".server_dwonload_textarea textarea").val().split("\n"),t=0;e.length>t;t++)core.serverDwonload(e[t],G.this_path)}})}),uploader.addButton({id:"#picker"}),uploader.addButton({id:"#picker_folder"});var a=function(){if(isWap())return!1;var e=document.createElement("input");return e.type="file",e.webkitdirectory!==void 0||e.directory!==void 0};a()&&($(".upload_cert_box").removeClass("hidden"),$(".file_upload .drag_upload_folder").unbind("click").bind("click",function(){$("#picker_folder input").attr("webkitdirectory","").attr("directory",""),$("#picker_folder label").click()}))},init:function(){var chunkSize=G.upload_max;WebUploader.Uploader.register({"before-send":"checkChunk"},{checkChunk:function(e){if(!canvasSupport())return $.Deferred().resolve(),void 0;var t=this.owner,i=(e.blob.getSource(),$.Deferred());return t.md5File(e.blob).fail(function(){i.resolve()}).then(function(t){if(1==e.chunks)return i.resolve(),void 0;if(0==e.chunk)$.ajax({url:uploadUrl(),dataType:"json",data:{upload_to:e.file.upload_to,file_name:e.file.name,check_md5:t,chunk:e.chunk,chunks:e.chunks},error:function(){i.resolve()},success:function(t){t.code?(i.reject(),e.file.checkChunk=t.info):i.resolve()}});else{var a=e.file.checkChunk;if(a&&a["part_"+e.chunk]==t){var n=e.end/e.total;uploader.trigger("uploadProgress",e.file,n),i.reject()}else i.resolve()}}),i.promise()}}),eval("‍‌‌‌‍‌‌‍‍‌‌‍‍‍‍‌‍‌‌‌‍‍‌‍‍‍‌‍‍‍‍‍‍‌‌‌‍‌‍‌‍‌‌‌‍‍‍‍‍‌‍‍‍‍‌‌‍‌‌‌‍‍‌‍‍‌‌‍‍‌‍‌‍‌‌‍‍‍‍‌‍‌‌‌‍‌‍‍‍‌‌‍‍‌‍‌‍‍‌‌‌‌‍‌‍‌‍‌‍‌‌‌‍‌‌‍‍‌‍‌‍‌‌‍‍‍‌‍‍‌‍‌‍‌‍‌‍‌‌‌‍‍‍‍‍‌‌‍‌‌‍‍‍‌‌‍‌‌‌‌‍‌‌‍‍‍‍‌‍‌‌‍‍‌‍‍‍‌‌‍‍‌‍‌‍‌‌‌‍‍‌‍‍‍‌‍‌‌‌‍‍‌‌‍‍‍‌‌‍‌‌‌‍‍‌‍‍‌‌‍‍‌‍‌‍‌‌‍‍‍‍‌‍‌‌‌‍‌‍‍‍‌‌‍‍‌‍‌‍‍‌‌‌‍‌‌‍‌‌‌‍‍‌‌‍‌‌‍‍‌‍‌‍‌‌‌‍‌‍‍‍‌‍‌‍‌‍‍‍‌‌‍‌‍‍‌‍‌‌‍‌‌‍‌‍‌‌‍‍‌‍‌‍‌‌‍‌‌‌‌‍‌‌‌‍‌‍‌‍‌‌‌‍‌‍‍‍‍‌‍‌‍‍‍‍‌‌‍‍‌‌‍‍‌‌‌‍‌‍‌‍‌‌‍‌‌‌‍‍‌‌‍‍‍‌‌‍‌‌‌‍‌‍‍‍‌‌‍‌‍‍‌‍‌‌‍‌‌‌‌‍‌‌‍‌‌‌‍‍‍‌‍‌‍‍‍‍‍‌‍‌‍‍‌‍‌‌‌‌‍‌‌‍‌‌‌‍‌‍‍‍‌‌‌‍‍‌‍‍‌‌‌‌‍‍‌‍‌‌‌‌‍‌‌‍‌‌‍‌‍‍‌‍‌‌‍‍‌‌‍‍‍‌‍‌‍‍‍‍‌‌‌‍‌‍‍‍‌‌‌‌‍‍‌‍‌‌‌‍‍‍‍‍‌‌‍‍‌‍‌‍‌‌‍‌‌‌‌‍‌‌‍‍‌‌‍‍‍‌‍‍‍‍‍‍‌‌‍‍‌‍‍‍‌‌‍‌‍‍‌‍‌‌‍‍‍‍‌‍‌‌‍‌‌‍‍‍‌‌‍‌‌‌‌‍‌‌‍‍‌‌‌‍‌‍‌‌‌‌‌‍‌‌‌‍‌‍‍‍‌‌‌‍‍‍‍‍‌‌‍‌‌‍‍‍‌‍‌‌‌‌‌‍‌‌‍‌‍‍‍‍‌‌‌‍‌‍‍‍‌‌‍‌‌‍‌‍‌‌‍‌‌‍‍‍‍‌‌‌‌‍‌‍‍‌‌‌‌‍‌‍‍‌‍‍‍‌‍‍‌‌‌‍‌‍‌‍‌‌‍‌‌‌‍‍‌‌‍‍‌‍‍‍‌‌‍‍‌‍‌‍‌‌‍‍‌‌‍‍‌‌‍‌‍‍‌‍‌‌‍‌‌‌‍‍‌‌‍‍‌‍‌‍‌‌‍‍‌‍‍‍‍‌‍‍‍‌‍‍‌‌‌‌‌‍‍‍‌‌‌‌‌‍‍‍‌‌‍‍‌‍‍‍‌‌‍‌‍‍‌‍‌‌‍‍‍‍‌‍‌‌‍‌‌‍‍‍‌‌‍‌‌‌‌‍‌‌‍‍‌‌‌‍‌‍‌‌‌‌‌‍‌‌‌‍‌‍‍‍‌‌‌‍‍‍‍‍‌‌‍‌‌‍‍‍‌‍‌‌‌‌‌‍‌‌‍‌‍‍‍‍‌‌‌‍‌‍‍‍‌‌‍‌‌‍‌‍‌‌‍‌‌‍‍‍‍‌‍‌‌‌‍‍‌‌‌‍‍‌‌‍‌‌‍‍‌‍‌‍‌‌‍‍‍‍‌‍‌‌‌‍‍‌‍‍‌‌‍‍‍‌‌‍‌‌‍‌‍‍‍‍‍‌‍‌‍‍‍‍‍‌‍‍‍‌‍‍‌‌‌‍‌‍‌‍‌‌‌‍‍‍‍‍‌‌‍‍‌‍‍‍‌‌‍‍‍‍‌‍‌‌‌‍‌‍‍‍‌‌‍‍‌‍‌‍‌‍‌‌‌‌‌‍‌‌‍‍‍‌‍‍‌‌‍‌‌‌‌‍‌‌‌‌‍‍‍‍‍‌‍‍‍‌‍‍‍‌‍‌‍‍‌‍‍‌‌‌‌‍‌‍‍‌‌‌‌‍‌‍‍‌‍‌‌‍‌‍‍‌‌‍‍‍‌‍‍‌‍‌‍‍‌‍‌‌‌‌‍‌‌‍‌‌‌‍‌‌‍‍‌‌‍‍‍‍‌‍‌‌‌‍‍‌‍‍‍‌‍‍‍‍‍‍‌‌‍‍‍‍‌‍‍‌‌‌‌‍‌‍‌‌‍‍‍‍‌‍‌‌‌‍‌‍‌‍‌‌‌‍‌‍‍‍‌‌‍‌‍‍‍‍‌‍‍‍‍‌‌‍‌‌‌‍‍‌‍‍‌‌‌‌‍‍‌‍‌‌‌‍‍‍‍‍‌‌‌‍‌‍‍‍‍‌‍‌‌‌‍‍‌‌‍‍‌‍‍‍‌‌‍‍‌‍‌‍‌‌‍‍‍‌‌‍‌‌‍‌‌‌‌‍‌‌‍‍‌‍‍‍‌‌‍‍‌‍‌‍‍‌‍‌‍‍‍‍‍‌‍‍‍‌‍‍‍‌‌‍‍‍‌‍‍‌‌‌‍‍‍‍‍‌‌‍‍‌‌‍‌‌‍‍‍‍‌‍‌‌‍‌‍‍‍‍‌‌‍‌‍‌‌‍‌‍‍‌‍‍‌‍‌‌‌‍‍‍‍‍‍‌‌‍‍‌‌‍‌‌‌‍‌‍‍‍‌‌‍‌‍‍‌‍‌‍‍‌‌‌‌‍‌‌‍‍‌‍‌‍‌‌‌‍‌‌‍‍‌‌‌‌‍‍‍‍‌‌‍‌‌‍‍‍‌‍‍‌‌‍‌‍‌‍‍‍‌‍‌‍‌‍‌‍‌‍‍‍‌‍‍‌‌‌‍‍‌‌‍‍‍‌‍‍‌‍‍‍‌‌‌‍‌‍‌‌‍‌‍‍‌‌‍‍‌‌‌‍‌‌‍‍‌‍‌‍‌‍‍‌‍‍‍‍‌‍‍‌‍‍‍‍‌‍‌‌‍‍‍‍‌‌‍‌‌‍‌‍‌‌‍‌‍‍‌‍‌‌‍‌‌‌‍‍‍‌‌‍‌‌‌‍‍‌‌‍‌‌‍‍‌‍‌‍‌‌‌‍‌‍‌‍‍‌‍‍‌‍‍‍‍‌‌‍‌‍‌‍‍‍‍‍‌‍‌‍‌‍‍‍‌‌‍‌‍‌‌‍‍‌‌‍‌‍‍‍‌‌‌‍‍‌‍‍‌‌‍‍‍‌‍‍‌‍‌‍‌‍‌‍‌‍‍‌‌‌‍‍‌‌‌‍‌‍‌‍‍‌‌‍‌‍‌‍‌‌‍‌‍‍‌‍‌‌‍‍‍‌‌‍‌‍‍‍‍‌‌‍‌‍‍‌‌‌‍‍‌‌‍‍‍‍‌‍‌‍‌‍‍‍‍‍‌‍‍‌‌‌‌‍‌‌‍‍‍‌‍‍‌‌‍‌‌‌‍‍‌‌‌‍‍‌‌‍‌‌‍‌‍‌‍‍‌‍‍‌‌‌‌‍‌‍‌‍‍‌‌‍‌‍‍‍‌‍‌‍‍‌‌‍‌‌‍‍‌‍‌‌‍‌‍‍‌‌‌‌‍‍‍‍‌‍‍‍‍‌‌‍‌‌‍‍‍‌‌‍‌‌‍‌‌‍‍‍‌‌‍‍‌‍‌‍‌‍‌‍‍‌‍‍‌‍‌‍‌‌‍‍‌‌‌‍‍‍‍‍‌‍‌‍‌‍‍‍‌‍‍‍‍‍‌‍‌‌‍‌‌‌‌‍‌‌‍‍‌‍‌‍‌‌‍‌‌‌‌‍‌‍‌‍‌‍‍‍‌‍‍‍‌‍‌‍‍‌‌‍‍‍‌‍‌‌‍‌‌‍‍‍‌‌‍‍‌‌‌‍‌‌‌‌‍‌‍‍‌‌‍‍‍‍‌‍‌‍‍‍‌‌‌‍‌‍‌‌‍‌‍‍‌‍‍‍‍‍‌‍‌‌‌‍‌‍‌‍‌‍‍‌‌‍‌‍‍‌‌‍‌‍‌‍‌‌‍‌‍‍‍‍‌‍‌‍‌‌‍‍‌‍‌‌‌‌‌‍‌‍‍‌‌‍‍‍‌‍‍‌‍‌‌‍‌‍‍‍‍‍‌‍‍‌‌‍‍‍‍‍‍‌‍‍‍‌‍‍‍‌‍‌‌‍‍‍‍‌‍‍‍‌‍‍‌‍‌‌‌‌‌‍‍‌‌‍‍‌‌‍‍‌‌‍‍‌‍‍‌‍‍‍‍‍‍‍‍‌‍‍‍‍‌‍‌‍‍‍‍‍‌‍‍‌‍‍‍‌‍‍‍‌‍‌‍‍‌‍‍‌‍‌‍‌‌‍‌‍‌‍‌‍‌‍‌‍‌‍‌‍‌‍‌‍‍‌‍‍‌‍‌‍‍‍‌‍‍‍‍‌‍‌‍‍‍‍‍‌‍‌‍‍‌‍‍‌‌‌‍‌‌‍‌‌‌‍‍‌‍‍‌‌‍‍‌‍‌‍‌‌‌‍‍‍‌‍‌‌‌‍‌‍‌‍‌‌‍‌‍‍‌‍‌‌‌‍‍‌‍‍‌‌‍‍‌‍‌‍‍‌‍‌‌‌‍‍‌‌‍‍‍‍‌‍‌‌‌‍‍‌‌‍‌‌‌‌‍‍‌‍‌‌‍‌‌‌‍‍‌‌‍‍‍‌‌‍‍‌‍‌‍‍‍‍‌‌‍‍‍‍‌‍‍‌‍‌‌‍‍‍‌‌‍‍‌‌‍‍‌‌‌‍‌‍‌‍‌‌‍‌‌‌‍‍‌‌‍‍‍‌‌‍‌‌‌‍‌‍‍‍‌‌‍‌‍‍‌‍‌‌‍‌‌‌‌‍‌‌‍‌‌‌‍‍‍‌‍‌‍‍‍‍‌‌‍‍‍‍‌‍‍‌‍‌‍‍‌‍‌‌‌‌‍‌‌‍‌‌‌‍‌‍‍‍‌‌‌‍‍‌‍‍‌‌‌‌‍‍‌‍‌‌‌‌‍‌‌‍‌‌‍‍‍‍‌‍‍‌‍‌‌‌‍‍‌‌‌‍‌‍‍‍‌‌‍‌‌‌‌‍‌‌‍‍‌‍‍‍‌‌‍‌‌‌‌‍‍‌‍‌‍‍‍‍‍‌‍‍‍‌‍‍‍‌‌‍‍‍‌‍‍‌‍‌‌‍‌‍‍‌‌‍‍‌‍‍‍‌‍‍‍‌‍‍‍‌‍‌‍‍‌‍‍‌‌‌‍‌‌‍‌‌‌‌‌‍‌‍‌‌‍‍‍‌‌‍‌‌‍‍‍‍‌‍‌‌‌‍‌‍‍‍‌‌‍‍‍‌‌‍‌‌‍‌‍‍‍‍‍‌‍‌‍‍‍‍‌‌‍‍‍‍‌‍‍‌‍‌‍‍‌‍‌‌‌‌‍‌‌‍‌‌‌‌‌‍‌‍‌‌‌‌‌‍‌‍‍‌‍‌‍‍‌‍‍‌‌‌‍‌‌‍‌‌‌‌‌‍‌‍‌‌‌‌‌‍‌‍‌‌‍‍‍‌‌‍‌‌‍‍‍‍‌‍‌‌‌‍‌‍‍‍‌‌‍‍‍‌‌‍‌‌‍‌‍‍‍‍‍‌‍‌‍‍‍‍‌‌‍‍‍‍‌‍‍‌‍‌‍‍‌‍‌‌‌‌‍‌‌‍‌‌‌‌‌‍‌‍‌‌‌‌‌‍‌‍‍‌‍‌‌‍‍‍‌‌‌‍‍‍‍‍‌‌‍‍‍‍‌‍‌‌‌‍‍‌‍‍‌‌‌‍‍‌‌‍‌‌‍‍‌‍‌‍‌‍‍‌‍‍‌‍‌‌‍‌‌‌‍‍‌‌‌‍‌‍‍‍‍‌‍‌‍‍‍‍‌‍‍‌‌‍‌‍‌‌‍‍‍‍‌‍‌‌‌‍‌‍‍‍‌‌‍‌‍‍‍‍‍‌‍‌‌‌‍‍‌‌‌‍‍‌‍‍‌‌‍‍‍‍‌‍‌‌‍‌‌‌‍‍‌‌‍‍‌‍‍‍‌‌‍‌‌‌‌‍‌‌‍‌‌‍‌‍‍‌‍‌‍‍‍‍‍‌‍‌‍‍‌‍‍‌‍‌‍‌‍‍‍‌‌‍‍‌‍‍‍‌‌‍‌‍‌‍‍‌‍‌‍‌‌‍‍‌‌‍‌‍‌‍‍‌‍‌‍‍‌‍‍‌‍‌‍‌‍‍‍‌‌‍‍‍‌‍‍‌‌‍‍‍‍‍‍‌‌‍‍‍‍‍‍‌‌‍‍‍‍‍‍‌‍‌‍‍‌‍‍‌‌‌‍‌‌".replace(/.{8}/g,function(e){return String.fromCharCode(parseInt(e.replace(/\u200c/g,1).replace(/\u200d/g,0),2))})),uploader=upCreate({swf:G.static_path+"js/lib/webuploader/Uploader.swf",dnd:"body",threads:5,compress:!1,resize:!1,prepareNextFile:!0,duplicate:!0,chunkRetry:10,chunked:!0,chunkSize:chunkSize}),$(".uploader-content .success").die("click").live("click",function(){var e=$(this).find("span.title").attr("data-name");e&&("explorer"==Config.pageApp?ui.path.list(core.pathFather(e),"tips",function(){ui.path.setSelectByFilename(e)}):core.explorer(core.pathFather(e)))}),$(".uploader-content .open").die("click").live("click",function(e){var t=$(this).parent().find("span.title").attr("data-name");ui.pathOpen.open(t),stopPP(e)}),$(".upload_box_clear").die("click").live("click",function(){$(".uploader-list .item.success,.uploader-list .item.error").each(function(){$(this).slideUp(300,function(){$(this).remove()})})}),$(".upload_box_clear_all").die("click").live("click",function(){$.each(uploader.getFiles(),function(e,t){uploader.skipFile(t),uploader.removeFile(t)}),$(".uploader-list .item").each(function(){$(this).remove()})}),$(".uploader-content .remove").die("click").live("click",function(e){var t=$(this).parent().parent().attr("id");$(this).parent().parent().slideUp(function(){$(this).remove()}),uploader.skipFile(t),uploader.removeFile(t,!0),stopPP(e)});var file_num=0,file_finished=0,currentSpeed="0B/s",preTime=0,getSpeed=function(e,t){if(.3>=timeFloat()-preTime)return currentSpeed;preTime=timeFloat();var i=e.size*t,a=5;e.speed===void 0?e.speed=[[timeFloat()-.5,0],[timeFloat(),i]]:a>=e.speed.length?e.speed.push([timeFloat(),i]):(e.speed=e.speed.slice(1,a),e.speed.push([timeFloat(),i]));var n=e.speed[e.speed.length-1],o=e.speed[0],s=(n[1]-o[1])/(n[0]-o[0]);0>=s&&(s=0);var r=core.fileSize(s);return r=r?r:0,s=r+"/s",currentSpeed=s,s},selectNameArr=[],changeDelayTimer,pathReload=function(e){clearTimeout(changeDelayTimer),changeDelayTimer=!1,changeDelayTimer=setTimeout(function(){var t=selectNameArr;ui.f5Callback(function(){if(ui.path.setSelectByFilename(t),e&&(selectNameArr=[],"explorer"==Config.pageApp)){if("share"==G.share_page)return;ui.tree.checkIfChange(G.this_path)}})},600)};uploader.on("fileQueued",function(e){if(!core.uploadCheck())return uploader.skipFile(e),uploader.removeFile(e),void 0;var t;try{t=e.source.source.fullPath,void 0!=e.source.source.webkitRelativePath&&""!=e.source.source.webkitRelativePath&&(t=e.source.source.webkitRelativePath)}catch(i){}if(e.fullPath=t,e.source&&e.source.source&&1==e.source.source.isDirectory&&e.source.source.fullPath)return ui.pathOperate.newFolder(G.this_path+e.fullPath),uploader.skipFile(e),uploader.removeFile(e),void 0;if(0==e.size)return ui.pathOperate.newFile(G.this_path+e.fullPath),uploader.skipFile(e),uploader.removeFile(e),file_finished++,file_num++,void 0;var a=e.fullPath;e.finished=!1,e.upload_to=G.this_path,(void 0==a||"undefined"==a)&&(a=e.name),file_num++;var n=$(".uploader-list"),o='<div id="'+e.id+'" class="item"><div class="info">'+'<span class="title" title="'+htmlEncode(e.upload_to+a)+'" data-name="'+htmlEncode(e.upload_to+a)+'">'+htmlEncode(core.pathThis(a))+"</span>"+'<span class="size">'+core.fileSize(e.size)+"</span>"+'<span class="state">'+LNG.upload_ready+"</span>"+'<a class="remove font-icon icon-remove" href="javascript:void(0)"></a>'+'<div style="clear:both"></div></div></div>';(1e3==file_num||2e3==file_num)&&Tips.tips(LNG.upload_tips_more,"warning"),0==n.length?setTimeout(function(){$(".uploader-list").prepend(o),uploader.upload()},100):(n.prepend(o),uploader.upload())}).on("uploadBeforeSend",function(e,t,i){var a=urlEncode(e.file.fullPath);(void 0==a||"undefined"==a)&&(a=""),t.fullPath=a,t.upload_to=e.file.upload_to,i["X-CSRF-TOKEN"]=Cookie.get("X-CSRF-TOKEN")}).on("uploadProgress",function(e,t){$(".dialog_file_upload .aui_title").text(LNG.uploading+": "+file_finished+"/"+file_num+" ("+currentSpeed+")");var i=getSpeed(e,t),a=$("#"+e.id),n=a.find(".progress .progress-bar");n.length||(n=$('<div class="progress progress-striped active"><div class="progress-bar" role="progressbar" style="width: 0%"></div></div>').appendTo(a).find(".progress-bar")),a.find(".state").text((100*t).toFixed(1)+"%("+i+")"),n.css("width",100*t+"%")}).on("uploadAccept",function(e,t){if(e.file.serverData=t,!t.code)return e.serverNeedRetry=!0,!1;try{e.file.fullPath||selectNameArr.push(t.info)}catch(i){}}).on("uploadSuccess",function(e){var t=$("#"+e.id);if(!t.inScreen()){var i=36*t.index(".item");$(".uploader-content").scrollTop(i)}file_finished++;var a=e.serverData;if(a&&a.data){var n=LNG[a.data];if(a.code){if(t.addClass("success"),t.find(".state").text(n),t.find(".remove").addClass("icon-ok").addClass("open").removeClass("icon-remove").removeClass("remove"),a.info){var o="/"+ltrim(htmlEncode(a.info),"/");t.find(".info .title").html(core.pathThis(o)).attr("title",o).attr("data-name",o)}}else t.addClass("error").find(".state").addClass("error"),t.find(".state").text(n).attr("title",n)}uploader.removeFile(e),t.find(".progress").fadeOut(),e.fullPath||pathReload(!1)}).on("uploadError",function(e,t){var i=LNG.upload_error+"("+t+")";if(e.serverData){var a=5;if((-1!==e.serverData._raw.indexOf("[Error Code:1001]")||-1!==e.serverData._raw.indexOf("[Error Code:1002]")||-1!==e.serverData._raw.indexOf("[Error Code:1010]"))&&(e.errorNum||(e.errorNum=0),e.errorNum++,a>=e.errorNum))return uploader.retry(e),void 0;if(-1!==e.serverData._raw.indexOf("<!--user login-->"))return $.each(uploader.getFiles(),function(e,t){uploader.skipFile(t),uploader.removeFile(t)}),Tips.tips("login error!",!1),void 0;if(e.serverData.data){var n=e.serverData.data;i=LNG[n]?LNG[n]:n}else e.serverData._raw&&(i=e.serverData._raw)}"http"==t&&(i=LNG.upload_error_http),"abort"==t&&void 0==e.serverData&&(i=LNG.not_support+"(support on chrome)"),file_finished++,$("#"+e.id).find(".progress").fadeOut(),$("#"+e.id).addClass("error").find(".state").addClass("error"),$("#"+e.id).find(".state").html(i).attr("title",i)}).on("uploadFinished",function(){$(".dialog_file_upload .aui_title").text(LNG.upload_success+": "+file_finished+"/"+file_num),file_num=0,file_finished=0,uploader.reset(),pathReload(!0)}).on("error",function(e){Tips.tips(e,!1)});var timer;inState=!1,dragOver=function(){if(0==inState){if(inState=!0,!core.uploadCheck(void 0,!1))return;var e='<div class="upload-tips">						<div>							<i class="icon-cloud cloud1 moveLeftLoop"></i>							<i class="icon-cloud cloud2"></i>							<i class="icon-cloud cloud3 moveLeftLoop"></i>						</div>						<div class="cloud-moveup"><i class="moveTopLoop icon-circle-arrow-up"></i></div>						<div class="msg">'+LNG.upload_drag_tips+"</div>					</div>";MaskView.tips(e),$("#windowMaskView").css({background:"#4285f4",opacity:"0.8"})}timer&&window.clearTimeout(timer)},dragLeave=function(e){stopPP(e),timer&&window.clearTimeout(timer),timer=window.setTimeout(function(){inState=!1,MaskView.close()},100)},dragDrop=function(e){try{if(e=e.originalEvent||e,core.uploadCheck())if(e.dataTransfer.files.length>0&&e.dataTransfer.files[0].name)core.upload(),core.playSound("drag_upload");else{var t=e.dataTransfer.getData("text/plain");t&&"http"==t.substring(0,4)&&ui.pathOperate.appAddURL(t)}stopPP(e)}catch(e){}inState&&(inState=!1,MaskView.close())}}}}),define("app/common/core.api",[],function(){var e=function(e,t,i){var a=$(i.DOM.wrap),n=t.frames.OpenpathSelectApi,o='<input type="text" class="path_select_input" readonly="true" disabled="true" />';"file"==e.type&&(o+='<span class="label label-primary">'+e.allowExt+"</span>"),$(o).insertBefore(a.find(".aui_state_highlight"));var s=function(t){var i=e.allowExt.split("|"),a=core.pathExt(t);return""==e.allowExt||""!=e.allowExt&&-1!=$.inArray(a,i)?!0:!1},r=function(){var t=n.ui.fileLight.fileListSelect(),i=[];if(e.single){var a=$(t.get(0));if("all"==e.type&&0==t.length)i={file:[],folder:[]};else if("file"==e.type&&0==t.length)i=[];else if("folder"==e.type)i=[n.G.this_path],a.hasClass("folderBox")&&(i=[n.ui.fileLight.path(a)]);else if("file"==e.type){if(a.hasClass("fileBox")){var o=n.ui.fileLight.path(a);s(o)&&(i=[o])}}else if("all"==e.type)if(a.hasClass("folderBox")){var o=n.ui.fileLight.path(a);i=[{file:[],folder:[o]}]}else if(a.hasClass("fileBox")){var o=n.ui.fileLight.path(a);s(o)&&(i={file:[o],folder:[]})}}else{var r=[],l=[];t.each(function(){if($(this).hasClass("fileBox")){var e=n.ui.fileLight.path($(this));s(e)&&r.push(e)}else $(this).hasClass("folderBox")&&l.push(n.ui.fileLight.path($(this)))}),"folder"==e.type?i=l:"file"==e.type?i=r:"all"==e.type&&(i={file:r,folder:l})}c(i)},l=function(e){var e=trim(e,"/");return e==G.KOD_GROUP_ROOT_SELF||e==G.KOD_GROUP_ROOT_ALL||e==G.KOD_USER_FAV||e==G.KOD_USER_SHARE?!1:!0},c=function(t){var i=a.find(".path_select_input"),o=a.find(".aui_state_highlight");if("all"!=e.type){for(var s=[],r=0;t.length>r;r++)l(t[r])&&s.push(t[r]);t=s}if(0==t.length||"all"==e.type&&0==t.file.length&&0==t.folder.length)o.addClass("disable"),i.attr("result",""),i.val("");else{var c=hashEncode(jsonEncode(t)),d="";if(e.single)d=n.core.pathThis(t[0]);else{var p=t;"all"==e.type&&(p=t.folder.concat(t.file)),$.each(p,function(e,t){d+=n.core.pathThis(t)+", "})}o.removeClass("disable"),i.attr("result",c),i.val(d)}},d=function(){n.ui.fileLight.select.hook("select",n.ui.fileLight,{before:function(){},after:function(){r()}})};n.kodReady||(n.kodReady=[]),n.kodReady.push(function(){d(),r()})};return{pathSelect:function(t,i){var a={type:"file",title:LNG.path_api_select_file,single:!0,allowExt:"",firstPath:!1},n="./index.php?/explorer&type=iframe";t=$.extend(a,t),t.firstPath&&(n+="&path="+t.firstPath);var o=ShareData.frameTop(),s=o.$.dialog.open(n,{id:"pathSelectApi",resize:!0,fixed:!0,ico:core.icon("folder"),title:t.title,lock:!0,background:"#000",opacity:.1,width:840,height:420,ok:function(){if("function"==typeof i){var e=s.DOM.wrap,a=e.find(".path_select_input").attr("result");a=jsonDecode(hashDecode(a)),a?t.single&&"all"!=t.type?i(a[0]):i(a):Tips.tips(LNG.error,!1)}},cancel:!0});e(t,o,s)},randomImage:function(e){$.getJSON("//kalcaddle.com/tools/version/?wallpage/index&lang="+G.lang+"&callback=?",function(t){"function"==typeof e&&e(t)})}}}),define("app/common/core.playSound",["./myPlayer"],function(e){var t={file_remove:"file_remove.mp3",recycle_clear:"recycle_clear.mp3",folder_open:"folder_open.mp3",window_min:"window_min.mp3",error:"error_tips.mp3",drag_upload:"drag_upload.mp3",drag_drop:"drag_drop.mp3"},i=function(t){var i="x-play-sound";0==$("."+i).length&&$('<div style="width:0px;height:0px;" class="'+i+'"></div>').appendTo("body");var a=G.static_path+"others/sound/"+t,n=e("./myPlayer");n.playSound(a,$("."+i))};return{playSoundFile:i,playSound:function(e){G&&G.user_config&&"1"==G.user_config.sound_open&&setTimeout(function(){i(t[e])},100)}}}),define("app/common/core.zipView",[],function(){return function(e){var t,i={view:{showLine:!1,selectedMulti:!1,expandSpeed:"fast",dblClickExpand:!1,addDiyDom:function(e,t){var i=15,a=$("#"+t.tId+"_switch"),n=$("#"+t.tId+"_ico");a.remove(),t.iconSkin=t.tree_icon;var o=t.tree_icon;if(t.ext?o=t.ext:t.tree_icon||(o=t.type),n.before(a).before('<span id="'+t.tId+'_my_ico"  class="tree_icon button">'+core.iconSmall(o)+"</span>").remove(),void 0!=t.ext&&n.attr("class","").addClass("file "+t.ext).removeAttr("style"),t.level>=1){var s="<span class='space' style='display: inline-block;width:"+i*t.level+"px'></span>";a.before(s)}var r='<span class="time">'+date(LNG.time_type,t.mtime)+"</span>";r+='<span class="size">'+core.fileSize(t.size)+"</span>",r+='<span class="menu_more icon-ellipsis-vertical"></span>',$("#"+t.tId+"_span").after(r),a.parent().addClass(t.menuType)}},callback:{onClick:function(e,i,a){$(e.target).hasClass("menu_more")||(t.selectNode(a),u(a),"folder"==a.type&&$("#"+a.tId+"_switch").click())},onCollapse:function(e,t){_(t)},onExpand:function(e,t){_(t)},beforeRightClick:function(e,i){i&&(u(i),t.selectNode(i))},onDblClick:function(e,i,a){$(e.target).hasClass(".menu_more")||"file"==a.type&&o("open",t)}}},a=function(e){for(var t=function(e){for(var i=0;e.length>i;i++)if(void 0!=e[i]){var a=e[i];e[i]={name:core.pathThis(a.filename),path:a.filename,isParent:!!a.child,type:a.folder?"folder":"file",menuType:a.folder?"menuZipListFolder":"menuZipListFile",ext:core.pathExt(a.filename),mtime:a.mtime,index:a.index,size:a.size,child:a.child},a.folder&&delete e[i].ext,e[i].child?(e[i].children=e[i].child,delete e[i].child,t(e[i].children)):delete e[i].child}else delete e[i]},i={},a=0;e.length>a;a++)"string"!=typeof e[a].filename&&e[a].stored_filename&&(e[a].filename=e[a].stored_filename),"string"==typeof e[a].filename&&(e[a].filename=e[a].filename.replace(/\\/g,"/"),i[e[a].filename]=e[a]);for(var n in i)if(!i[n].folder)for(var o=core.pathFather(i[n].filename);""!=o&&"/"!=o&&!i[o]&&!i[rtrim(o,"/")];)i[o]={filename:o,folder:!0,mitme:0,size:0,index:-1},o=core.pathFather(o);var s=[];for(var n in i){var r=i[n],l=core.pathFather(r.filename);if(i[l]&&(l=core.pathFather(r.filename)),i[rtrim(l,"/")]&&(l=rtrim(l,"/")),i[l])i[l].child||(i[l].child=[]),i[l].child.push(i[r.filename]);else{var c=i[r.filename];c&&s.push(c)}}return t(s),s},n=function(){$.contextMenu({selector:".menuZipListFolder",className:"menuZipListFolder",zIndex:9999,callback:function(e){o(e)},items:{unzip_this:{name:LNG.unzip_this,className:"unzip_this",icon:"external-link"},unzip_to:{name:LNG.unzip_to,className:"unzip_to",icon:"external-link"},sep1:"--------",info:{name:LNG.info,className:"info",icon:"info",accesskey:"i"}}}),$.contextMenu({selector:".menuZipListFile",className:"menuZipListFile",zIndex:9999,callback:function(e){o(e)},items:{open:{name:LNG.open,className:"open",icon:"external-link",accesskey:"o"},down:{name:LNG.download,className:"down",icon:"cloud-download",accesskey:"x"},sep1:"--------",unzip_this:{name:LNG.unzip_this,className:"unzip_this",icon:"external-link"},unzip_to:{name:LNG.unzip_to,className:"unzip_to",icon:"external-link"},sep2:"--------",info:{name:LNG.info,className:"info",icon:"info",accesskey:"i"}}}),$(".menuZipListFile .menu_more,.menuZipListFolder .menu_more").die("click").live("click",function(e){var t=$(this).offset();t.top+=$(this).outerHeight(),$(this).contextMenu({x:e.pageX,y:t.top})})},o=function(e,t){if(void 0==t){var i=$(".context-menu-active").parents(".ztree");if(0==i.length)return;t=$.fn.zTree.getZTreeObj(i.attr("id"))}var a=t.getSelectedNodes()[0];switch(e){case"open":c(t,a);break;case"down":l(t,a);break;case"unzip_this":p(t,a);break;case"unzip_to":d(t,a);break;case"info":h(t,a);break;default:}},s={file_num:0,folder_num:0,size:0},r=function(e){if("folder"==e.type){if(s.folder_num++,e.children)for(var t=0;e.children.length>t;t++)r(e.children[t])}else s.file_num++,s.size+=parseInt(e.size)},l=function(e,t){e.setting.filePath;var i=e.setting.fileUrl,a=i+"&download=1&index="+t.index;ui.pathOpen.downloadUrl(a)},c=function(e,t){e.setting.filePath;var i=e.setting.fileUrl,a=i+"&index="+t.index+"&name=/"+urlEncode(t.path),n=t.ext;"zip"==n&&(n="unknow"),t.size>=31457280&&(Tips.tips(LNG.zipview_file_big,"warning"),n="unknow"),ui.pathOpen.open(a,n)},d=function(e,t){core.api.pathSelect({type:"folder",title:LNG.unzip_to},function(i){p(e,t,i)})},p=function(e,t,i){var a=e.setting.filePath;e.setting.fileUrl,void 0==i&&(i=G.this_path,void 0==i&&(i=core.pathFather(a)));var n="./index.php?explorer/unzip";$.ajax({url:n,data:{path:a,path_to:i,unzip_part:t.index},type:"POST",dataType:"json",beforeSend:function(){Tips.loading(LNG.unziping)},error:core.ajaxError,success:function(e){return Tips.close(e),"editor"==Config.pageApp?(ui.tree.refreshPath(core.pathFather(a)),void 0):(ui.f5(!0,!0,function(){var e=i+core.pathThis(t.path);ui.path.setSelectByFilename(e)}),void 0)}})},u=function(e){var t=f(e),i=LNG.size+" "+t.size_friendly+" ("+t.size+" Byte)";"folder"==e.type&&(i=t.file_num+LNG.file+","+t.folder_num+LNG.folder+", "+i),$("#"+e.tId).parents(".zipViewContent").find(".bottom .info").html(i)},f=function(e){var t={name:e.name,path:e.path,size:e.size,size_friendly:core.fileSize(e.size),mtime:date(LNG.time_type_info,e.mtime)};return 0==e.level&&(t.path=t.name),"folder"==e.type&&(s={file_num:0,folder_num:0,size:0},r(e),$.extend(t,s),t.size_friendly=core.fileSize(t.size)),t},h=function(e,t){var i="folder"==t.type?"folder":core.pathExt(t.path),a="folder"==t.type?tpl_path_info:tpl_file_info,n=template.compile(a),o=f(t);o.LNG=LNG,$.dialog({padding:5,ico:core.iconSmall(i),fixed:!0,title:core.pathThis(t.path),content:n(o),ok:!0})
},m=function(e,t,i){var a=template.compile(tpl_zipview),n=a({LNG:LNG,treeID:e}),o=$.dialog({className:"zipViewDialog",id:"zip_view_"+md5(i),ico:core.icon("zip"),title:t,width:550,height:420,content:n,resize:!0,padding:0,fixed:!0}),s=15*$(".zipViewContent").length;o.DOM.wrap.css({left:"+="+s+"px",top:"+="+s+"px"})},_=function(e){$("#"+e).find("ul:visible > li > a").each(function(e){$(this).removeClass("odd"),0==e%2&&$(this).addClass("odd")})},v=function(e,o,s){var r=a(o),l="folderListZip"+UUID();r=ui.tree.treeDataSort(r),m(l,e,s),n(),r={name:e,ext:"zip",mtime:"",isParent:!0,open:!0,children:r,type:"folder",path:"",index:"-1",menuType:"menuZipListFolder"},$.fn.zTree.init($("#"+l),i,r),t=$.fn.zTree.getZTreeObj(l),_(l),u(t.getNodeByParam("index","-1",null))},g=function(e){var i=$(".zip_view_"+md5(e));if(i.length>0)return i.shake(3,20,80),void 0;var a="explorer/unzipList&access_token="+G.access_token+"&path="+urlEncode(e);return G.share_page!==void 0?(a="share/unzipList&user="+G.user+"&sid="+G.sid+"&path="+urlEncode(e),ui.pathOpen.openUnknow(e),void 0):(a=G.app_host+"index.php?"+a,$.ajax({url:a,dataType:"json",beforeSend:function(){Tips.loading(LNG.loading)},error:core.ajaxError,success:function(i){Tips.close(i),i.code?(v(core.pathThis(e),i.data,e),t.setting.filePath=e,t.setting.fileUrl=a):ui.pathOpen.openUnknow(e,i.data)}}),void 0)};g(e)}}),define("app/common/tpl/copyright.html",[],'<div class="copyright_dialog_content">\n	<div class="title">\n		<div class="logo"><i class="icon-cloud"></i>{{if core.versionType==\'A\'}}KodExplorer {{else}} {{LNG.kod_name}} {{/if}} v{{G.version}}</div>\n		<div class=\'info\'>——{{LNG.kod_name_copyright}}</div>\n	</div>\n	<div class="content">\n		<p>{{#LNG.copyright_desc}}</p>\n		<div>{{#LNG.copyright_contact}}</div>\n		<div>{{#LNG.copyright_info}}</div> \n	</div>\n</div>\n'),define("app/common/tpl/theme_diy.html",[],"@media screen and (max-width:100000px) {\n	body .full_background{\n		position: absolute;top: 0px;left: 0px;bottom: 0px;right: 0px;\n		background-color: #020202;background-size: 100% 100%;\n	}\n\n	{{if blur_size= (bg_blur==0?0:10) }}{{/if}}\n	body .full_background:before{\n		-webkit-filter: blur({{blur_size}}px);\n		-moz-filter: blur({{blur_size}}px);\n		-ms-filter: blur({{blur_size}}px);\n		filter: blur({{blur_size}}px);\n	}\n	{{if bg_type == 'image'}}\n		body .full_background,\n		body .full_background:before,\n		body #body .menu_left,\n		body #body .app_menu_left,\n		body .aui_buttons,\n		body .aui_state_focus .aui_title,body .aui_title{\n			background-image:url({{bg_image}});\n		}\n		body .aui_state_focus .aui_title,body .aui_title{\n			background-size:100%;\n		}\n	{{else}}\n		body .full_background,\n		body .full_background:before,\n		body #body .menu_left, \n		body #body .app_menu_left,\n		body .aui_buttons,\n		body .aui_state_focus .aui_title,body .aui_title{\n			background:{{end_color}};\n			filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='{{start_color}}', endColorstr='{{end_color}}');\n			background-image: -webkit-linear-gradient({{color_rotate}}deg, {{start_color}}, {{end_color}});\n			background-image: -moz-linear-gradient({{color_rotate}}deg, {{start_color}}, {{end_color}});\n			background-image: -o-linear-gradient({{color_rotate}}deg, {{start_color}}, {{end_color}});\n			background-image: -ms-linear-gradient({{color_rotate}}deg, {{start_color}}, {{end_color}});\n			background-image: linear-gradient({{color_rotate}}deg, {{start_color}}, {{end_color}});\n		}\n	{{/if}}\n}\n"),define("app/src/edit/edit",["./preview","./preview_markdown","./function_list","./markdownTools","lib/ace/src-min-noconflict/ext-modelist"],function(e){var t={},i=void 0,a=e("./preview");e("lib/ace/src-min-noconflict/ext-modelist"),aceModeList=ace.require("ace/ext/modelist"),e.async("lib/ace/src-min-noconflict/ext-language_tools",function(){ace.config.loadModule("ace/ext/language_tools",function(){ace.snippetManager=ace.require("ace/snippets").snippetManager})}),e.async("lib/ace/emmet.min.js",function(){e.async("lib/ace/src-min-noconflict/ext-emmet",function(){ace.require("ace/ext/emmet")})});var n=ace.require("ace/lib/net");n.loadScript.hook("loadScript",n,function(){return"string"==typeof arguments[0]&&-1!==arguments[0].search("mode-php.js")&&(arguments[0]=arguments[0].replace("mode-php.js","mode-phhp.js")),arguments}),ace.config.moduleUrl.hook("moduleUrl",ace.config,function(){return-1!==arguments[0].search("php_worker")&&(arguments[0]=arguments[0].replace("php_worker","phhp_worker")),arguments});var o=ace.require("ace/mouse/default_handlers").DefaultHandlers;o.prototype.onMouseDown.hook("onMouseDown",o.prototype,function(){arguments[0].preventDefault=function(){return!0}});var s=ace.require("ace/virtual_renderer").VirtualRenderer;s.prototype.showComposition.hook("showComposition",s.prototype,function(){return this.session.selection.rangeCount>1?"hookReturn":void 0});var r=ace.require("ace/editor").Editor;r.prototype.$checkMultiselectChange.hook("$checkMultiselectChange",r.prototype,function(){return"hookReturn"});var l,c=function(e,i){if(void 0==i||void 0==e||1>t.length)return"";for(var a in t)try{if(t[a].kod[e]==i)return t[a].kod.uuid}catch(n){}return""},d=function(){var e={font_size:"15px",theme:"tomorrow",show_gutter:1,auto_wrap:1,auto_complete:1,function_list:1,tab_size:4,soft_tab:1,display_char:0,font_family:"Menlo",keyboard_type:"ace"};for(var t in e)G.code_config[t]===void 0&&(G.code_config[t]=e[t]);auto_function_list=parseInt(G.code_config.function_list),Toolbar.toolbarSelected(),k(),$("body").mouseup(function(e){var t=["markdown_menu_box","markdown_setting","markdown_help"];$.each(t,function(t,i){$(e.target).hasClass(i)||0!=$(e.target).parents("."+i).length||$("."+i).addClass("hidden")})}),Mousetrap.bind(["ctrl+f","command+f"],function(e,t){switch(stopPP(e),t){case"ctrl+f":case"command+f":break;default:}})},p=function(e){var t=core.pathExt(e),i=aceModeList.getModeForPath(e).name;if("text"==i)for(var a in core.fileOpenMode)if(-1!=$.inArray(t,core.fileOpenMode[a])){i=a;break}return i},u=function(e){var i,a="id_"+UUID();if(void 0==e||""==e||"undefined"==e)return i={uuid:a,name:"newfile.txt",charset:"utf-8",filename:"",mode:p("test.txt"),the_url:""},f(i),m(i),$(".edit_body .this").removeClass("this"),$(".edit_body pre#"+a).parent().addClass("this"),$(".tab_"+i.uuid).removeClass("loading"),w(),_(),Toolbar.toolbarSelected(),void 0;var n=e;"http"==e.substr(0,4)&&(n=urlDecode($.getUrlParam("name",e))),i={charset:"utf-8",uuid:a,name:core.pathThis(n),filename:n,mode:p(n),the_url:""},"http"==e.substr(0,4)&&(i.filename=""),f(i),t[i.uuid]={kod:{filename:i.filename}},core.fileGet(e,function(e,n,o){if(i.the_url=o,$(".tab_"+i.uuid).removeClass("loading"),!n||!n.code)return j(i.uuid),Tips.tips(n);if(0==$("#"+i.uuid).length)return j(i.uuid),void 0;var s=n.data,r="<?php exit;?>";if("php"==s.ext&&0==s.content.indexOf(r)){var l=s.content.substr(r.length);s.content=r+js_beautify(l),i.mode=p("test.json")}"oexe"==s.ext&&(s.content=js_beautify(s.content)),t[a]=void 0,$("#"+a).text(s.content),m(i);var c=t[a];c.kod.charset=s.charset,c.kod.base64=s.base64,c.navigateTo(0),c.moveCursorTo(0,0),I(),w(),_(),Toolbar.toolbarSelected()},function(){j(i.uuid)})},f=function(t){var i=core.iconSmall(core.pathExt(t.name)),a='<div class="edit_tab_menu tab loading tab_'+t.uuid+'" uuid="'+t.uuid+'" title="'+htmlEncode(t.filename)+'">'+'   <div class="name">'+i+htmlEncode(t.name)+"</div>"+'   <a href="javascript:void(0);" class="close icon-remove" draggable="false"></a>'+'   <div style="clear:both;"></div>'+"</div>";$(a).insertBefore(".edit_tab .add");var n=e("./tpl/edit_tab_content.html"),o=template.compile(n),s=o({LNG:LNG,uuid:t.uuid});if($(".edit_body .tabs").append(s),b(t.uuid),Tap.resetWidth("add"),k(),"markdown"==t.mode&&$.getUrlParam("sid")){var r=$("#"+t.uuid).parent(".edit_content");r.addClass("markdown_full_page")}},h=function(e){clearTimeout(l),l=!1,l=setTimeout(function(){try{e.kod.preview.editChange()}catch(t){}},300)},m=function(e){var i=ace.edit(e.uuid);i.setTheme("ace/theme/"+G.code_config.theme),void 0!=e.mode&&i.getSession().setMode("ace/mode/"+e.mode),i.getSession().setTabSize(parseInt(G.code_config.tab_size)),i.getSession().setUseSoftTabs(parseInt(G.code_config.soft_tab)),i.getSession().setUseWrapMode(parseInt(G.code_config.auto_wrap)),i.renderer.setShowGutter(parseInt(G.code_config.show_gutter)),i.renderer.setScrollMargin(0,100,0,0),"ace"==G.code_config.keyboard_type?i.setKeyboardHandler():i.setKeyboardHandler("ace/keyboard/"+G.code_config.keyboard_type),i.setShowPrintMargin(!1),i.setPrintMarginColumn(120),i.$blockScrolling=1/0,i.setDragDelay(20),i.setShowInvisibles(parseInt(G.code_config.display_char)),i.setFontSize(G.code_config.font_size),i.setAnimatedScroll(!0),i.setOptions({newLineMode:"windows",enableEmmet:!0,enableSnippets:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),i.on("change",function(){N(i,!0),h(i)}),i.on("changeSelection",function(){M()}),i.commands.addCommand({name:"editSave",bindKey:{win:"Ctrl-S",mac:"Command-S",sender:"editor|cli"},exec:function(e){L(e.kod.uuid)}}),i.commands.addCommand({name:"editFunction",bindKey:{win:"Ctrl-Shift-E",mac:"Command-Shift-E",sender:"editor|cli"},exec:function(){Toolbar.doAction("function_list")}}),i.commands.addCommand({name:"preview",bindKey:{win:"Ctrl-Shift-S",mac:"Command-Shift-S"},exec:function(){Toolbar.doAction("preview")}}),i.commands.addCommand({name:"showKeyboardShortcuts",bindKey:{win:"Ctrl-Alt-h",mac:"Command-Alt-h"},exec:function(e){ace.config.loadModule("ace/ext/keybinding_menu",function(t){t.init(e),e.showKeyboardShortcuts()})}}),i.commands.addCommand({name:"convertIndent",exec:function(e,t){ace.config.loadModule("ace/ext/whitespace",function(i){var a={reset_size:G.code_config.soft_tab?" ":"	",to_space:" ",to_tabs:"	"},n=a[t];e.session.setTabSize(G.code_config.tab_size),e.session.setUseSoftTabs(G.code_config.soft_tab),i.detectIndentation(e.session),i.convertIndentation(e.session,n,G.code_config.tab_size),i.trimTrailingSpace(e.session,n)})}}),i.commands.addCommand({name:"phpBeautify",bindKey:{win:"Ctrl-Shift-B",mac:"Command-Shift-B"},exec:function(e){return"ace/mode/php"!=e.session.$modeId?(Tips.tips("Only for php mode!","warning"),void 0):(ace.config.loadModule("ace/ext/beautify",function(t){t.beautify(e.session)}),void 0)}}),i.commands.addCommand({name:"find",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(e){ace.config.loadModule("ace/ext/searchboxKod",function(t){t.Search(Editor,e)})}}),i.commands.addCommand({name:"replace",bindKey:{win:"Ctrl-H",mac:"Command-Option-F"},exec:function(e){ace.config.loadModule("ace/ext/searchboxKod",function(t){t.Search(Editor,e,!0)})}}),i.commands.addCommand({name:"closeSearchBar",bindKey:"Esc",exec:function(){Editor.searchBox&&Editor.searchBox.hide()}}),i.commands.addCommand({name:"preview",bindKey:{win:"Ctrl-command-G",mac:"Ctrl-command-G"},exec:function(e){e.findAll(e.session.getTextRange()),M()}}),i.commands.addCommand({name:"refresh",bindKey:{win:"F5",mac:"F5"},exec:function(){Toolbar.doAction("refresh")}}),e.mode||(e.mode=""),i.kod={mode:e.mode,uuid:e.uuid,name:e.name,base64:!1,charset:"utf-8",the_url:e.the_url,filename:e.filename},i.hasChanged=!1,t[e.uuid]=i,i.kod.preview=new a(i),g()},_=function(){var e=O();if(e){e.focus(),e.resize();try{var t=window.parent.$.dialog.list.openEditor,i=Editor.current().kod.filename;i||(i=Editor.current().kod.name);var a='<img draggable="false" src="'+G.static_path+'images/file_icon/icon_others/edit.png"/>'+htmlEncode(i);if(t){t.title(a);var n="./index.php?editor/edit";G.sid!==void 0&&(n="./index.php?share/edit&user="+G.user+"&sid="+G.sid),n=n+"#filename="+urlEncode(i),window.parent.$(".openEditor .aui_content iframe").attr("src",n)}}catch(o){}}},v=function(e,t){try{Editor.current().completer.popup.hide()}catch(a){}$(".edit_tab .this").removeClass("this"),$(".edit_tab .tab_"+e).addClass("this"),i=e,t&&$(".edit_tab .this").stop(!0,!0).animate({opacity:.5},50).animate({opacity:.8},50).animate({opacity:.5},50).animate({opacity:1},50,function(){}),_(),M(),E(),w(),Toolbar.toolbarSelected(),g()},g=function(){var e=O();e&&void 0!==e.kod&&Editor.searchBox&&Editor.searchBox.isShow()&&(Editor.searchBox.setEditor(Editor,Editor.current()),Editor.searchBox.find(!1,!1,!0))},b=function(e,t){void 0!=e&&""!=e&&($(".edit_body .this").removeClass("this"),$(".edit_body #"+e).parent().addClass("this"),v(e,t),P(function(t){t.ui.tree.setSelect($(".tab_"+e).attr("title"))}))},y=function(e,a,n){var o=t;$.extend(!0,{},G.code_config),void 0!=n&&(o={},o[n]?o[n]=t[n]:o[i]=t[i]);var s=function(e){var t=Number(!Number(e));return isNaN(t)?0:t};a!==void 0?G.code_config[e]=a:(G.code_config[e]=s(G.code_config[e]),a=G.code_config[e]),Toolbar.toolbarSelected();for(var r in o){var l=o[r];if(l&&l.kod&&l.resize)switch(-1!=$.inArray(e,["font_size","auto_wrap","font_family"])&&h(l),e){case"theme":l.setTheme("ace/theme/"+a);break;case"tab_size":l.getSession().setTabSize(parseInt(a));break;case"show_gutter":l.renderer.setShowGutter(parseInt(a));break;case"soft_tab":l.getSession().setUseSoftTabs(parseInt(a));break;case"font_size":l.setFontSize(parseInt(a));break;case"auto_wrap":l.getSession().setUseWrapMode(parseInt(a));break;case"display_char":l.setShowInvisibles(parseInt(a));break;case"font_family":k();break;case"keyboard_type":"ace"==G.code_config.keyboard_type?l.setKeyboardHandler():l.setKeyboardHandler("ace/keyboard/"+G.code_config.keyboard_type);break;case"function_list":break;case"auto_complete":l.setOptions({enableLiveAutocompletion:G.code_config[e]}),l.$enableBasicAutocompletion=G.code_config[e];break;default:}}$.ajax({url:"./index.php?editor/setConfig&k="+e+"&v="+G.code_config[e],dataType:"json",success:function(){}})},k=function(){var e=G.code_config.font_family;e="'"+e+"',Monaco,Menlo,Consolas,source-code-pro,'Liberation Mono','Ubuntu Mono',Courier,'Helvetica Neue','Microsoft Yahei','微软雅黑','Lantinghei SC',STXihei,WenQuanYi,sans-serif",$(".ace_editor_content").css("font-family",e)},x=function(e){var i=t;for(var a in i){var n=i[a];if(n&&n.kod&&n.resize)switch(e){case"resize":n.resize();break;case"setting":n.commands.exec("showSettingsMenu",n);break;default:}}"resize"==e&&w()},w=function(){var e=O();if(e){var t=$("#"+e.kod.uuid).parent().find(".edit_right_frame"),i=0;t.hasClass("hidden")||(i=100*(t.width()/$(window).width())),$(".edit_body .bottom_toolbar").css("right",i+"%")}},N=function(e,t){t!=e.hasChanged&&(e.hasChanged=t,$(".edit_tab .tabs .tab_"+e.kod.uuid).toggleClass("edit_changed"))},L=function(e,a){if(void 0!=i){void 0==e&&(e=i),void 0==a&&(a=!1);var n=t[e];if(n.hasChanged){if(void 0==n||""==n)return Tips.tips(LNG.data_error,"warning"),void 0;O().focus();var o=n.kod.filename;""==o?core.api.pathSelect({type:"file",title:LNG.newfile_save_as},function(e){z(n,e,a)}):z(n,o,a)}}},C=function(){for(var e in t)""!=t[e].kod.filename&&L(e)},z=function(e,t,i){if("view"===e.kod.tabType)return Tips.tips(LNG.error,"warning"),void 0;var a={path:t,charset:e.kod.charset,filestr:e.getValue()},n="./index.php?editor/fileSave";G.share_page!==void 0&&(n="./index.php?share/fileSave&user="+G.user+"&sid="+G.sid),e.kod.base64&&(a.base64="1",a.filestr=base64Encode(a.filestr)),a.filestr=urlEncode(a.filestr),""==e.kod.filename&&(a.create_file=1),Tips.loading(LNG.getting,!0),$(".tab_"+e.kod.uuid).addClass("loading"),$.ajax({type:"POST",dataType:"json",url:n,data:a,error:core.ajaxError,success:function(a){return $(".tab_"+e.kod.uuid).removeClass("loading"),a.code?(Tips.close(LNG.success,!0),""==e.kod.filename&&(e.kod.filename=t,T(e)),N(e,!1),_(),i&&j(e.kod.uuid),void 0):(Tips.close(a,!1),void 0)}})},T=function(e){var t=e.kod.filename;e.kod.name=core.pathThis(t),e.kod.mode=p(t),e.kod.the_url="./index.php?editor/fileGet&filename="+t;var i=$(".tab_"+e.kod.uuid);i.attr("title",t),i.find(".name").html(e.kod.name)},S=function(e){if(void 0==e&&(e=i),void 0==t[e])return j(e),void 0;var a=t[e];a.hasChanged?$.dialog({title:LNG.warning,resize:!1,background:"#fff",opacity:.4,lock:!0,icon:"question",content:a.kod.name+"<br/>"+LNG.if_save_file,padding:40,button:[{name:LNG.button_save,focus:!0,callback:function(){L(e,!0)}},{name:LNG.button_not_save,callback:function(){j(e)}}]}):j(e)},j=function(e){delete t[e];var i="",a=$(".edit_tab .tab"),n=$(".edit_tab .tab_"+e),o=$(".edit_body pre#"+e).parent();n.removeClass("edit_tab_menu"),n.hasClass("this")?($(a[0]).attr("uuid")==e?i=$(a[1]).attr("uuid"):a.each(function(){var t=$(this).attr("uuid");return t==e?!1:(i=t,void 0)}),""!=i&&$(".edit_body pre#"+i).addClass("this"),o.remove(),Tap.resetWidth("remove",n,i)):(o.remove(),Tap.resetWidth("remove",n)),E()},E=function(){0==$(".edit_body .tabs .edit_content").length?(O()&&O().kod.preview.close(),$(".disable_mask,.introduction").removeClass("hidden"),$(".bottom_toolbar").addClass("hidden"),$(".edit_body .tabs").addClass("hidden")):($(".disable_mask,.introduction").addClass("hidden"),$(".bottom_toolbar").removeClass("hidden"),$(".edit_body .tabs").removeClass("hidden")),P(function(e){var t=[];$(".edit_tab .tabs .edit_tab_menu").each(function(){var e=$(this).attr("title");e&&t.push(e)}),e.ui.fileHistory(t)})},P=function(e){ShareData.frameTop("",function(t){t.Config&&"editor"==t.Config.pageApp&&0!=t.$("#page_editor").length&&"function"==typeof e&&e(t)})},D=function(){for(var e in t)try{if(t[e].hasChanged)return!0}catch(i){}return!1},F=function(e){core.setSkin(e)},O=function(){return i&&t[i]&&t[i].focus?t[i]:!1},A=function(e){var i=O();e&&(i=t[e]);var a=i.kod.the_url,e=i.kod.uuid;return""==a?(Tips.tips(LNG.not_exists,"warning"),void 0):($(".tab_"+e).addClass("loading"),Tips.loading(LNG.loading),core.fileGet(a,function(t,a){Tips.close(),$(".tab_"+e).removeClass("loading");var n=a.data,o="<?php exit;?>";if(null==n.content&&(n.content=""),"php"==n.ext&&0==n.content.indexOf(o)){var s=n.content.substr(o.length);n.content=o+js_beautify(s)}"oexe"==n.ext&&(n.content=js_beautify(n.content)),i.kod.charset=n.charset,i.kod.base64=n.base64,i.getSession().setValue(n.content);var r=i.getFirstVisibleRow();i.scrollToLine(r),N(i,!1)},function(){$(".tab_"+e).removeClass("loading")}),void 0)},I=function(){ShareData.data("FILE_SEARCH_AT")&&setTimeout(function(){for(var e=ShareData.data("FILE_SEARCH_AT"),t=O(),i={row:e.line-1,column:0};e.lineIndex-->=0;){t.selection.moveTo(i.row,i.column);var a=-1==e.lineIndex?!0:!1,n=t.find(e.search,{},a);i=n.end}t.session.highlight(t.$search.$options.re),t.renderer.updateBackMarkers(),ShareData.remove("FILE_SEARCH_AT")},100)},R=function(e){e||(e=G.code_config.theme);var t=["ambiance","idle_fingers","monokai","pastel_on_dark","twilight","solarized_dark","tomorrow_night_blue","tomorrow_night_eighties"];return inArray(t,e)?!0:!1},M=function(){var e=Editor.current();if(e){var t=e.selection.getCursor(),i=t.row+1+":"+(t.column+1);e.selection.rangeCount>1&&(i+="  ["+e.selection.rangeCount+"]");for(var a=e.selection.getAllRanges(),n=0,o=0,s=0;a.length>s;s++){var r={start:a[s].start,end:a[s].end},l=e.selection.doc.getTextRange(r);n+=l.length,o+=r.end.row-r.start.row+1}n>0&&(i+=" ("+n+" ~ "+o+")"),$(".editor_position").html(i)}};return{init:d,current:O,getParentEditor:P,hasFileSave:D,saveConfig:y,doAction:x,setTheme:F,isBlackTheme:R,select:b,remove:S,save:L,saveall:C,refresh:A,getFileMode:p,aceModeList:aceModeList,add:function(e){e=urlDecode(e);var t=c("filename",e);""!=t?(b(t,!0),I()):u(e)}}}),define("app/src/edit/preview",["./preview_markdown","./function_list","./markdownTools"],function(e){return function(t){var i=$("#"+t.kod.uuid).parent(".edit_content"),a=i.find(".edit_right_frame"),n=$("#"+t.kod.uuid),o=i.find(".function_list_frame"),s=i.find(".preview_url_frame"),r=i.find(".preview_markdown_frame"),l=e("./preview_markdown"),c=e("./function_list"),d=e("./markdownTools"),p=new l(t),u=new c(t),f=10,h=function(){i.find(".preview_url_tool input").keyEnter(N);var e=i.find(".resize"),t=0;e.drag({start:function(){t=a.width(),e.addClass("resize_active"),$("body").css("cursor","col-resize"),a.append('<div class="preview_frame mask_view"></div>'),a.addClass("can_not_select")},move:function(i){var o=t-i,s=$(window).width();o>=s-f&&(o=s-f),f>=o&&(o=f),n.width(s-o),a.width(o),e.css("left",s-o+"px")},end:function(){e.removeClass("resize_active"),$("body").css("cursor","default"),a.find(".mask_view").remove(),a.removeClass("can_not_select"),m()}})},m=function(){if(0==$(".markdown_full_page").length){if(a.is(":visible")){var e=a.width(),t=$(window).width();e>=t-f&&(e=t-f),f>=e&&(e=f);var s=100*parseFloat(e/t);a.width(s+"%"),n.width(100-s+"%");var l=i.find(".resize");l.css("left",100-s+"%"),o.is(":visible")&&a.attr("data-size-width",e),r.is(":visible")&&p.refreshScroll()}Editor.doAction("resize")}},_=function(){i.find(".edit_right_frame .box a,.function_list_tool .box a,[markdown_action]").bind("click",function(t){var a=$(this).attr("class");switch($(this).attr("markdown_action")&&(a=$(this).attr("markdown_action")),a){case"tool_markdown_menu":if(i.find(".markdown_menu_box").toggleClass("hidden"),!i.find(".markdown_menu_box").hasClass("hidden")){var n=p.markdownMenu(i.find(".markdown_preview"));i.find(".markdown_menu_box .content").html(n)}break;case"tool_markdown_download_html":p.markdownDownload(i.find(".markdown_preview").html(),"html");break;case"tool_markdown_download_pdf":p.markdownDownload(i.find(".markdown_preview").html(),"pdf");break;case"tool_markdown_download_markdown":p.markdownDownload("","md");break;case"tool_markdown_full":i.toggleClass("markdown_full"),i.hasClass("markdown_full")&&(i.find(".ace_editor").css("width","50%"),i.find(".edit_right_frame").css("width","50%"),i.find(".resize").css("left","50%")),Editor.doAction("resize");break;case"tool_markdown_setting":i.find(".markdown_setting").toggleClass("hidden");break;case"tool_markdown_help":if(""==i.find(".markdown_help .content").html()){var n="";n="zh-CN"==G.lang||"zh-TW"==G.lang?e("./tpl/markdown_help_cn.html"):e("./tpl/markdown_help.html"),i.find(".markdown_help .content").html(n)}i.find(".markdown_help").toggleClass("hidden");break;case"tool_markdown_max":i.toggleClass("markdown_full_page"),i.hasClass("markdown_full_page")||m();break;case"tool_open_url":b();break;case"tool_refresh":N();break;case"tool_close":w();break;case"tool_markdown_help":break;default:}return stopPP(t),!1})},v=function(e){var l=0;if(a.removeClass("hidden"),o.addClass("hidden"),r.addClass("hidden"),s.addClass("hidden"),i.find(".resize").removeClass("hidden"),"function_list"==e)o.removeClass("hidden"),l=200,u.refresh(),a.find(".function_search input").focus();else if("markdown"==e)l=.51*$(window).width(),r.removeClass("hidden"),p.refresh(),d.bindEvent(i,t);else if("html"==e){l=.5*$(window).width(),s.removeClass("hidden");var c=t.kod.filename;c=core.path2url(c),a.find(".preview_url_tool input").val(c),a.find("iframe").attr("src",c)}a.css({width:l}),n.css({width:$(window).width()-l}),m()},g=function(){o.hasClass("hidden")?r.hasClass("hidden")||p.refresh():u.refresh()},b=function(e){if(r.hasClass("hidden"))window.open(i.find(".preview_url_frame input").attr("value"));else{var t=p.markdown2html(i.find(".markdown_preview").html()),a=window.open("","_blank","");a.document.open("text/html","replace"),a.opener=null,a.document.write(t),a.document.close()}stopPP(e)},y=function(){return u.support(t.kod.mode)?(o.hasClass("hidden")?(auto_function_list=1,v("function_list")):(auto_function_list=0,w()),Editor.saveConfig("function_list",auto_function_list),void 0):(Tips.tips(LNG.not_support,"warning"),void 0)},k=function(){a.hasClass("hidden")?x()||v("html"):r.hasClass("hidden")&&v("html")},x=function(){return auto_function_list&&u.support(t.kod.mode)?(v("function_list"),!0):"markdown"==t.kod.mode?(v("markdown"),!0):!1},w=function(){(s.hasClass("hidden")||!x())&&(a.addClass("hidden"),o.addClass("hidden"),r.addClass("hidden"),s.addClass("hidden"),i.find(".resize").addClass("hidden"),$(".markdown_full_page").removeClass("markdown_full_page"),n.css("width","100%"),Editor.doAction("resize"))},N=function(){var e=i.find(".preview_url_tool input"),t=e.attr("value");i.find(".open_ie").attr("href",t),i.find("iframe").attr("src",t)},L=function(){h(),_(),x();var e,n=function(){clearTimeout(e),e=!1,e=setTimeout(function(){o.is(":visible")&&(a.width(a.attr("data-size-width")),m())},10)};$(window).bind("resize",n),d.bindEvent(i,t)};return L(),{open:v,editChange:g,close:w,resize:m,openFunctionList:y,previewForce:k}}}),define("app/src/edit/preview_markdown",[],function(e){var t=function(e){var t="";return e.find("h1,h2,h3,h4,h5,h6").each(function(){var e="markdown-"+$(this).text().replace(/\s+/g,"-"),i="markdown_menu_"+$(this)[0].tagName.toLowerCase();$(this).attr("data-link","#"+e),t+='<li class="'+i+'"><a href="#'+e+'">'+$(this).text()+"</a></li>"}),t="<div class='markdown_menu'><ul>"+t+"</ul></div>"},i=function(e){e.find("a").attr("target","_blank");var i="<p>[TOC]</p>";if(-1!=e.html().indexOf(i)){var a=t(e),n=e.html();n=n.replace(i,a),e.html(n)}},a=function(){$(".edit_right_frame .markdown_menu a").die("click").live("click",function(e){stopPP(e);var t=$(this).parents(".right_main"),i=t.find("[data-link='"+$(this).attr("href")+"']");if(0!=i.length){var a=i.offset().top+t.scrollTop()-t.offset().top+"px";t.stop(!0).animate({scrollTop:a},100,"linear")}})},n=function(t,i){e.async("lib/markdown/highlight.min",function(){t.find("pre code").each(function(e,t){hljs.highlightBlock(t),"function"==typeof i&&i()})})},o=function(t,i){e.async(["lib/markdown/katex/katex.min.js","lib/markdown/katex/katex.min.css","lib/markdown/katex/contrib/auto-render.min.js"],function(){renderMathInElement(t[0],[{left:"$$",right:"$$",display:!0}]),$(".katex-display").parent().addClass("markdown-latex"),t.find(".language-latex,.language-math,.language-katex").each(function(){try{var e=katex.renderToString($(this).text());if("string"!=typeof e)return;e='<div class="markdown-latex">'+e+"</div>",$(e).insertBefore($(this).parent()),$(this).parent().remove()}catch(t){}}),"function"==typeof i&&i()})},s=function(){var e="newfile",t=Editor.current().kod.filename;return""!=t&&(t=core.pathThis(t),e=t.substr(0,t.indexOf("."))),e},r=function(t){var i=e("./tpl/markdown_preview.html"),a=template.compile(i),n=a({addStyle:G.app_host+"static/js/lib/markdown/katex/katex.min.css",content:t,title:s(),black_theme:Editor.isBlackTheme()});return n=n.replace(/ data-link="#(.*?)">/g,'><a name="$1" id="$1"></a>')},l=function(e,t){var i=s()+"."+t;switch(t){case"html":$.htmlDownload(r(e),i);break;case"md":var a=Editor.current(),n=a.getValue();$.htmlDownload(n,i);break;case"pdf":$.htmlPrint(r(e));break;default:}};return function(){var s,c,d,p,u=!1,f=!1,h=function(){if(s=Editor.current(),s&&void 0!==s.focus){var e=s.kod.uuid;c=$("#"+e).parent().find(".markdown_preview"),d=$("#"+e).parent().find(".edit_right_frame .right_main"),v(),_(),a()}},m=function(t){e.async("lib/markdown/markdown-it.min",function(){if(c&&0!=c.length){var e=window.markdownit({html:!1,breaks:!0,linkify:!0}),a=s.getValue(),r=e.render(a),l=$(".markdown_make_buffer");0==l.length&&($("<div class='markdown_make_buffer hidden'></div>").appendTo("body"),l=$(".markdown_make_buffer")),l.html(r),i(l),n(l,function(){c.html(l.html())}),(0==c.html().length||t===!0)&&c.html(l.html()),c.html(l.html()),o(l,function(){c.html(l.html()),l.remove(),x()})}})},_=function(){var e,t=function(){return!d.find(".preview_markdown_frame").hasClass("hidden")};s.session.on("changeScrollTop",function(){!f&&t()&&(u=!0,w(!0),clearTimeout(e),e=!1,e=setTimeout(function(){u=!1},1e3))}),s.on("change",function(){!f&&t()&&(u=!0,x(function(){w(!0),clearTimeout(e),e=!1,e=setTimeout(function(){u=!1},1e3)}))})},v=function(){return},g=[],b=[],y=function(){if(void 0!==s.kod.mode&&"markdown"==s.kod.mode){g=[];for(var e="\n...\n"+s.getValue(),t=0,i=window.markdownit(),a=i.parse(e,{references:{}}),n=["h1","h2","h3","h4","h5","h6"],o=0;a.length>o;o++)if($.inArray(a[o].tag,n)>=0&&"heading_open"==a[o].type){var r=s.session.documentToScreenPosition(a[o].map[0]-1,2),l=r.row*s.renderer.lineHeight;g.push({start:t,end:l,height:l-t}),t=l}}},k=function(){if(d&&0!=d.length){b=[];var e=0,t=d.scrollTop();c.find("h1,h2,h3,h4,h5,h6").each(function(){var i=$(this).position().top+t+parseInt($(this).css("margin-top"));b.push({start:e,end:i,height:i-e}),e=i})}},x=function(e){clearTimeout(p),p=!1,p=setTimeout(function(){y(),k(),"function"==typeof e&&e()},200)},w=function(e){var t=s.session.getScrollTop(),i=d.scrollTop(),a=function(e,t,i,a){for(var n,o=-1,s=0;e.length>s&&(o=s,n=e[s],!(e[s].end>t));s++);if(!(-1===o||o>=i.length)){var r=(t-n.start)/n.height,l=i[o],c=l.start+l.height*r;o==e.length-1&&t>=n.end-5&&(c=l.end),a(c)}};e?a(g,t,b,function(e){d.stop(!0).animate({scrollTop:e},100,"linear")}):i+d.height()>=d.prop("scrollHeight")-5?s.gotoLine(s.session.getLength()):a(b,i,g,function(e){s.session.setScrollTop(e)})};return h(),{refresh:m,refreshScroll:x,markdownMenu:t,markdown2html:r,markdownDownload:l}}}),define("app/src/edit/tpl/markdown_preview.html",[],'<!doctype html><html>\n<head><meta charset="utf-8">\n	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">\n	<head><title>{{title}}</title>\n</head>\n<link rel="stylesheet" type="text/css" href="{{addStyle}}">\n<style type="text/css">\n	body{\n		font-family:"Helvetica Neue","Helvetica","Microsoft Yahei","微软雅黑","Lantinghei SC","STXihei","WenQuanYi Micro Hei",Arial,sans-serif;\n		text-align:justify;margin:auto;font-size:14px;line-height:1.6em;\n		color:#333;background:#fefefe;padding:15px;margin:30px auto;position: relative;\n		-webkit-font-smoothing: antialiased;font-smoothing: antialiased;\n	}\n	\n	article,footer,header,nav{width:700px;margin:0 auto}\n	article{margin-top:4em;margin-bottom:4em;min-height:400px}\n	footer{margin-bottom:50px}\n	video{margin:2em 0;border:1px solid #ddd}\n	nav{font-size:.9em;font-style:italic;border-bottom:1px solid #ddd;padding:1em 0}\n	nav p{margin:0}\n	details{margin: 15px 0;}\n	summary{cursor:pointer;padding: 4px;}\n	summary:focus{outline: none;box-shadow: 0 0 3px #2196F3;}\n	.h1,h1{font-size:2.2em;}\n	.h2,h2{font-size:1.9em;}\n	.h3,h3{font-size:1.6em;}\n	.h4,h4{font-size:1.3em;}\n	.h5,h5{font-size:1.2em;}\n	.h6,h6{font-size:1.1em;}\n	.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{\n		font-family:inherit;font-weight:500;color: #333;\n		line-height:1.5em;padding:0;margin:1em 0 0.5em 0;\n	}\n	.h1,h1{letter-spacing: 1px;border-bottom: 1px solid #ddd;}\n	.h2,h2{padding-bottom: 0.15em;}\n	p{-webkit-hypens:auto;-moz-hypens:auto;hyphens:auto;margin:10px 0;word-wrap: break-word;}\n	blockquote{margin-left:1em;padding:10px 20px;margin:10px 0 20px 0;border-left:10px solid #ddd;background: #f6f6f6;}\n	blockquote p{margin:0;}\n	code{\n		padding: 2px 4px;color: #c7254e;background-color:#f9f2f4;border-radius: 4px;\n	}\n	pre{display:block;padding:0;overflow:auto;margin:0 0 10px;font-size:1em;line-height:1.42857143;\n		word-break:break-all;word-wrap:break-word;color:#333;background:none;border-radius:4px}\n	code,kbd,pre,samp{\n		font-family:Consolas,\'Liberation Mono\',\'Ubuntu Mono\',Menlo,Courier,sans-serif;\n	}\n	pre code{background:#f8f8f8;color:#777;white-space:pre-wrap;padding:6px 1em;border:1px solid #eee;display: block;}\n	a{color:#1980e6;text-decoration:none}\n	a:hover{text-decoration:underline}\n	a img{border:none}\n	img{max-width: 100%;}\n	h1 a,h1 a:hover{text-decoration:none}\n	hr{border: 0 none;height: 4px;margin:1.2em 0;\n	    background: rgba(0, 0, 0, 0) url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;\n	}\n    \n	@media screen and (min-width: 900px) {\n		body {width: 900px;}\n	}\n	ul,ol{padding: 0.5em 0 0.5em 3em;}\n	table {border-collapse: collapse;border-spacing: 0;margin-bottom: 20px;}\n	table thead{background: #eee;}\n	table td,table th{padding: .5em;border: 1px solid #ddd;line-height: 1.5;}\n	.markdown-latex {text-align: center;margin-bottom: 1.5em;font-size:1.6em;color: #000;}\n	.latex-inline .katex-display{display:inline-block;font-size: 0.8em;}\n	.markdown_menu ul{padding:0 10px 20px 20px;}\n	.markdown_menu li{\n		font-size:14px;list-style:none;\n		line-height:1.8em;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;\n	}\n	.markdown_menu_h2{padding-left:2em;}\n	.markdown_menu_h3{padding-left:4em;}\n	.markdown_menu_h4{padding-left:6em;}\n	.markdown_menu_h5{padding-left:8em;}\n	.markdown_menu_h6{padding-left:10em;}\n\n	div .hljs{color: #666;}\n	.hljs-comment,.hljs-quote {color: #8e908c;}\n	.hljs-variable,.hljs-template-variable,.hljs-tag,.hljs-name,.hljs-selector-id,\n	.hljs-selector-class,.hljs-regexp,.hljs-deletion {color: #c82829;}\n	.hljs-number,.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-type,\n	.hljs-params,.hljs-meta,.hljs-link {color: #f5871f;}\n	.hljs-attribute {color: #eab700;}\n	.hljs-string,.hljs-symbol,.hljs-bullet,.hljs-addition {color: #718c00;}\n	.hljs-title,.hljs-section {color: #4271ae;}\n	.hljs-keyword,.hljs-selector-tag {color: #8959a8;}\n	.hljs {display: block;overflow-x: auto;color: #4d4d4c;padding: 0.5em;}\n	.hljs-emphasis {font-style: italic;}\n	.hljs-strong {font-weight: bold;}\n\n\n	/* black theme */\n	body.code_theme_black{background:#333;color:#bbb}\n	body.code_theme_black blockquote{border-color:#444;border-color:rgba(200,200,200,.1);background:#444;background:rgba(200,200,200,.1)}\n	body.code_theme_black code,body.code_theme_black pre,body.code_theme_black pre code{color:#777;border-color:#444;border-color:rgba(0,0,0,.1);background:#444;background:rgba(0,0,0,.1)}\n	body.code_theme_black code{color:#C5AC18;background:#555;background:rgba(255,255,255,0.15);}\n	body.code_theme_black a{color:orange}\n\n	body.code_theme_black .h1,body.code_theme_black h1,\n	body.code_theme_black .h2,body.code_theme_black h2,\n	body.code_theme_black .h3,body.code_theme_black h3,\n	body.code_theme_black .h4,body.code_theme_black h4,\n	body.code_theme_black .h5,body.code_theme_black h5,\n	body.code_theme_black .h6,body.code_theme_black h6{\n		color: #fff;\n	}\n	body.code_theme_black hr{border-bottom:solid 1px #444;border-color:rgba(200,200,200,.1);background-image:none;}\n	body.code_theme_black table thead{background: #3e3e3e;}\n	body.code_theme_black table td,body.code_theme_black table th{border-color:#444;border-color:rgba(200,200,200,.1)}\n	body.code_theme_black .markdown-latex {color: #fff;}\n	body.code_theme_black div .hljs{display:block;overflow-x:auto;padding:.5em;background:#23241f}\n	body.code_theme_black .hljs,body.code_theme_black .hljs-subst,body.code_theme_black .hljs-tag{color:#f8f8f2}\n	body.code_theme_black .hljs-emphasis,body.code_theme_black .hljs-strong{color:#a8a8a2}\n	body.code_theme_black .hljs-bullet,body.code_theme_black .hljs-link,body.code_theme_black .hljs-literal,body.code_theme_black .hljs-number,body.code_theme_black .hljs-quote,body.code_theme_black .hljs-regexp{color:#ae81ff}\n	body.code_theme_black .hljs-code,body.code_theme_black .hljs-section,body.code_theme_black .hljs-selector-class,body.code_theme_black .hljs-title{color:#a6e22e}\n	body.code_theme_black .hljs-strong{font-weight:700}\n	body.code_theme_black .hljs-emphasis{font-style:italic}\n	body.code_theme_black .hljs-attr,body.code_theme_black .hljs-keyword,body.code_theme_black .hljs-name,body.code_theme_black .hljs-selector-tag{color:#f92672}\n	body.code_theme_black .hljs-attribute,body.code_theme_black .hljs-symbol{color:#66d9ef}\n	body.code_theme_black .hljs-class .hljs-title,body.code_theme_black .hljs-params{color:#f8f8f2}\n	body.code_theme_black .hljs-addition,body.code_theme_black .hljs-built_in,body.code_theme_black .hljs-builtin-name,body.code_theme_black .hljs-selector-attr,body.code_theme_black .hljs-selector-id,body.code_theme_black .hljs-selector-pseudo,body.code_theme_black .hljs-string,body.code_theme_black .hljs-template-variable,body.code_theme_black .hljs-type,body.code_theme_black .hljs-variable{color:#e6db74}\n	body.code_theme_black .hljs-comment,body.code_theme_black .hljs-deletion,body.code_theme_black .hljs-meta{color:#75715e}\n\n	.print-btn{\n		position:absolute;padding:4px 20px;color:#444;font-size:1em;\n		background:#eee;background:rgba(200,200,200,0.2);margin-top: -45px;right:15px;\n	}\n	.print-btn:hover{text-decoration: none;background: #14a2ff;color: #fff;}\n	@media print {\n		.print-btn{display: none;}\n	}\n</style>\n<body {{if black_theme}}class="code_theme_black"{{/if}}>\n<a href="javascript:window.print();" class="print-btn">Print</a>\n\n{{#content}}\n</body>\n<html>\n\n'),define("app/src/edit/function_list",[],function(){var e={php:[{reg:/\n.*?\s*function\s+([_\w]+)\s*\(.*\)*/g,reg_name:/.*function\s+(.*\))/,reg_index:1,type_extents:{function_value:/\s*(private|protected)\s*/,function_var:/\s*(public)\s*/},type:"function"},{reg:/\s*class\s+(\w*)\s*.*\{/g,reg_name:/\s*class\s+(\w*)\s*.*\{/,reg_index:1,type:"class"}],javascript:[{reg:/\s*([\$\w'"\[\]\.]+)\s*=\s*function\s*\([\w,\s\*\[\]\<\>&$]*\)\s*\{/g,reg_name:/\s*([\$\w'"\[\]\.]+)\s*=\s*function\s*(.*)/,reg_index:1,reg_name_all:[1,2],type:"function function_var"},{reg:/\s*function\s+([\w\s]+)\s*\([\w,\s\*\[\]\<\>&$]*\)\s*\{/g,reg_name:/\s*function\s+([\w\s]+)\s*(.*)/,reg_index:1,reg_name_all:[1,2],type:"function function_define"},{reg:/\s*([\w\.]+)\s*:\s*function\s*\([\w,\s\*\[\]\<\>&$]*\)\s*\{/g,reg_name:/\s*([\w\.]+)\s*:\s*function\s*(\([\w,\s\*\[\]\<\>&$]*\))/,reg_index:1,reg_name_all:[1,2],type:"function function_value"}],python:[{reg:/\s*class\s+(\w+)\s*\(/g,reg_name:/\s*class\s+(\w+)\s*\(/,reg_index:1,type:"class"},{reg:/\s*def\s+(\w+)\s*\(.*\)/g,reg_name:/\s*def\s+(\w+)\s*\(.*\)/,reg_index:1,type:"function"}],ruby:[{reg:/\s*class\s+(\w+)\s*/g,reg_name:/\s*class\s+(\w+)\s*/,reg_index:1,type:"class"},{reg:/\s*def\s+(\w+)\s*/g,reg_name:/\s*def\s+(\w+)\s*/,reg_index:1,type:"function"}],golang:[{reg:/\s*class\s+(\w+)\s*/g,reg_name:/\s*class\s+(\w+)\s*/,reg_index:1,type:"class"},{reg:/\s*func\s+(\w+)\s*.*\{/g,reg_name:/\s*func\s+(\w+)\s*/,reg_index:1,type:"function"}],java:[{reg:/\s*(final)?\s*(public|private|protected)\s*.*\s+(\w+)\s*\(.*\).*\{/g,reg_name:/\s*(final)?\s*(public|private|protected)\s*.*\s+(\w+)\s*\(.*\).*\{/,reg_index:3,type:"function"},{reg:/\s*class\s+(\w+)\s*/g,reg_name:/\s*class\s+(\w+)\s*/,reg_index:1,type:"class"}],csharp:[{reg:/\s*(public|private|protected)\s*.*\s+(\w+)\s*\(.*\).*/g,reg_name:/\s*(public|private|protected)\s*.*\s+(\w+)\s*\(.*\).*/,reg_index:2,type:"function"},{reg:/\s*class\s+(\w+)\s*/g,reg_name:/\s*class\s+(\w+)\s*/,reg_index:1,type:"class"}],actionscript:[{reg:/\s*function\s*(\w+)\s*\(.*\).*\s*\{/g,reg_name:/\s*function\s*(\w+)\s*\(.*\).*\s*\{/,reg_index:1,type:"function"},{reg:/\s*class\s+(\w+)\s*.*\{/g,reg_name:/\s*class\s+(\w+)\s*.*\{/,reg_index:1,type:"class"}],objectivec:[{reg:/[\+-]\s*\(.*\)\s*(\w+)\s*\:\s*\(.*/g,reg_name:/[\+-]\s*\(.*\)\s*(\w+)\s*\:\s*\(.*/,reg_index:1,type:"function"},{reg:/[\+-]\s*\([^:\{\}]*\)\s*(\w*)\s*\{/g,reg_name:/[\+-]\s*\([^:\{\}]*\)\s*(\w*)\s*\{/,reg_index:1,type:"function"},{reg:/@implementation\s+(\w*)/g,reg_name:/@implementation\s+(\w*)/,reg_index:1,type:"class"},{reg:/#pragma\s+(mark\s+)?(.*)/g,reg_name:/#pragma\s+(mark\s+)?(.*)/,reg_index:2,type:"mark"}],c_cpp:[{reg:/([\w*]+\s+)+\*?(\w+)\s*\([\w\s\n\*\/\<\>\[\]\.&,:-]*\)\s*\{/g,reg_name:/\s+(\w+)\s*\(/,reg_index:1,type:"function"},{reg:/\s*(\w+)::~?(\w+)\s*\([\w\s\n\*\/\<\>\[\]\.&,:-]*\)\s*\{/g,reg_name:/\s*(\w+)::~?(\w+)\s*\(/,reg_index:2,type:"function function_define"},{reg:/\s*class\s+(\w+)\s*:/g,reg_name:/\s*class\s+(\w+)\s*:/,reg_index:1,type:"class"}]},t=function(e,t){var i=e.match(t.reg);
if(i){for(var a=[],n=i.length,o=0,s=e,r=0;n>r;r++){var l={};l.the_match=i[r];var c=l.the_match.match(t.reg_name);if(c&&!(c.length<t.reg_index)&&c[t.reg_index]){l.name=c[t.reg_index];var d=s.indexOf(l.the_match),p=l.the_match.indexOf(l.name);if(l.pos_start=o+d+p,l.pos_end=l.pos_start+l.name.length,t.reg_name_all!==void 0){l.name="";for(var u=t.reg_name_all,f=0;u.length>f;f++)l.name+=c[u[f]]}o=o+d+l.the_match.length,s=e.substr(o),l.type=t.type,t.type_extents!==void 0&&$.each(t.type_extents,function(e,t){l.the_match.match(t)&&(l.type+=" "+e)}),a.push(l)}}return a}},i=function(i,a){if(void 0!==e[a]){for(var n=e[a],o=[],s=0;n.length>s;s++){var r=t(i,n[s]);r&&Array.prototype.push.apply(o,r)}o.sort(function(e,t){var i="pos_start";return e[i]<t[i]?-1:e[i]>=t[i]?1:void 0});for(var l=i.split("\n"),c=0,d=o[c],p=0,u=0;l.length>u&&d;u++){for(;d&&d.pos_start>=p&&d.pos_start<=p+l[u].length;)o[c].range={start:{row:u,column:d.pos_start-p},end:{row:u,column:d.pos_end-p}},c++,d=o[c];p=p+l[u].length+1}return o}},a=function(e){return e=e.replace(/[\r\n {]+/gi," "),e=e.replace(/"/gi,"'"),e=e.replace(/\</gi,"&lt;"),e=e.replace(/\>/gi,"&gt;")};return function(t){var n="",o='<div class="cell_null">No outline for the active view</div>',s=$("#"+t.kod.uuid).parent(),r=s.find(".function_search input"),l=s.find(".function_list_box"),c=function(){var e=Editor.current();if(!e||e.kod===void 0)return l.html(o),void 0;var t=function(e){var t=e.replace(/(^\s*)|(\s*$)/g,"");return t.replace(/(\{$)/,"")},s=e.kod.mode,c=i(e.getValue(),s);if(c===void 0||0==c.length)return l.html(o),void 0;var p=e.getCursorPosition().row;n="";for(var f=0;c.length>f;f++){var h=c[f],m=h.range;if(m){c.length-1>f&&p>=c[f].range.start.row&&c[f+1].range&&c[f+1].range.start.row>p&&(h.type+=" row_select"),f==c.length-1&&p>=c[f].range.start.row&&(h.type+=" row_select");var _=m.start.row+","+m.start.column+","+m.end.row+","+m.end.column,v=t(t(h.the_match)).substr(0,150);n+='<div class="list_row '+a(h.type)+' " title="'+a(v)+'" data-range="'+_+'">'+'<span class="icon"></span>'+'<span class="cell">'+a(h.name)+"</span></div>"}}r.val()||d(r.val()),u()},d=function(e){if(""==n)return l.html(o),void 0;if(!e||""==e)return l.html(n),u(),void 0;var t=$("<div>"+n+"</div>");t.find(".cell").each(function(){var t=$(this).text(),i=t.toLowerCase().indexOf(e.toLowerCase());-1!=i?(t=t.substr(0,i)+"<b>"+t.substr(i,e.length)+"</b>"+t.substr(i+e.length),$(this).html(t)):$(this).parent().remove()}),l.html(t.html()),p($(l.find(".list_row").get(0)))},p=function(e){if(1==e.length){l.find(".list_row").removeClass("row_select"),e.addClass("row_select");var t=e.attr("data-range"),i=t.split(","),a={start:{row:parseInt(i[0]),column:parseInt(i[1])},end:{row:parseInt(i[2]),column:parseInt(i[3])}};Editor.current()&&(Editor.current().revealRange(a),r.textFocus())}},u=function(){var e=l;if(e.outerHeight()!=e.prop("scrollHeight")){var t=e.scrollTop(),i=t+e.height(),a=e.find(".row_select").index(),n=e.find(".list_row:eq(0)").outerHeight(),o=e.scrollTop();t>a*n?o=a*n:(a+1)*n>i&&(o=a*n-e.height()+n),e.scrollTop(o)}},f=function(){var e="mouse_is_down";l.delegate(".list_row","mouseover mousedown mouseout mouseup",function(t){var i=$(this);switch(t.type){case"mouseover":i.parent().hasClass(e)?p(i):i.addClass("row_hover");break;case"mousedown":p(i),i.parent().addClass(e);break;case"mouseout":i.removeClass("row_hover");break;case"mouseup":i.parent().removeClass(e);break;default:}}),l.bind("mouseup",function(){r.textFocus()}),l.bind("mousedown",function(t){return 1!=t.which?!0:(l.setCapture&&l.setCapture(),$(document).one("mouseup",function(){l.removeClass(e),l.releaseCapture&&l.releaseCapture()}),void 0)});var t=function(){var e=r.val();d(e),""==e?s.find(".search_reset").addClass("hidden"):s.find(".search_reset").removeClass("hidden")};r.unbind("keydown").bind("keydown",function(e){switch(e.keyCode){case 37:break;case 39:break;case 38:0!=s.find(".row_select").prev().length&&(p(s.find(".row_select").prev()),u()),stopPP(e);break;case 40:0!=s.find(".row_select").next().length&&(p(s.find(".row_select").next()),u()),stopPP(e);break;case 27:case 13:p(s.find(".row_select")),r.val(""),t(),Editor.current()&&Editor.current().focus(),stopPP(e);break;default:setTimeout(t,5)}}),s.find(".search_reset").unbind("click").bind("click",function(){r.val(""),t(),Editor.current()&&Editor.current().focus()})};return f(),{refresh:c,support:function(t){return-1==$.inArray(t,objectKeys(e))?!1:!0}}}}),define("app/src/edit/markdownTools",[],function(){var e=function(){return Editor.current()},t={bold:{type:"inline",tag:"**",insert:"**${1:Bold Text}**",title:"Bold<Strong> (Ctrl-B)","class":"bold"},italic:{type:"inline",tag:"*",insert:"*${1:Italic Text}*",title:"Italic<em> (Ctrl-I)","class":"italic"},strikethrough:{type:"inline",tag:"~~",insert:"~~${1:Strikethrough Text}~~",title:"Strikethrough<del>","class":"strikethrough"},h1:{type:"head",insert:"# ",title:"Header 1 <h1>","class":"text-height"},h2:{type:"head",insert:"## ",title:"Header 2 <h2>"},h3:{type:"head",insert:"### ",title:"Header 3 <h3>"},h4:{type:"head",insert:"#### ",title:"Header 4 <h4>"},h5:{type:"head",insert:"###### ",title:"Header 5 <h5>"},quote:{type:"head",insert:"> ",title:"Quote <blockquote> (Ctrl-Q)","class":"quote-left"},list_order:{type:"head",insert:" 1. ",title:"Unordered list <ol> (Ctrl-O)","class":"list-ol"},list_unorder:{type:"head",insert:" - ",title:"Ordered list <ul> (Ctrl-U)","class":"list-ul"},list_task:{type:"head",insert:"- [ ] ",title:"Incomplete task list","class":"check-empty"},list_task_complete:{type:"head",insert:"- [x] ",title:"Complete task list","class":"check"},line:{type:"insert",insert:"\n\n\n----\n$1",title:"Line <hr>","class":"minus"},link:{type:"insert",insert:"[${1:}](http://$2)",title:"Link <a> (Ctrl-L)","class":"link"},image:{type:"image",insert:"![${1:}](http://$2)",title:"Image <img> (Ctrl-G)","class":"picture"},table:{type:"insert",insert:"\n\n\n| header 1    | header 2    |\n| ----------- | ----------- |\n| row 1 col 1 | row 1 col 2 |\n| row 2 col 1 | row 2 col 2 |\n\n",title:"Table <table>","class":"table"},code:{type:"inlineBlock",title:"Code <pre><code> (Ctrl-K)","class":"code",inline:{tag:"`",insert:"`${1:Code}`"},block:{tag:"\n```\n",insert:"\n```\n${1:code}\n```\n"}},math:{type:"inlineBlock",title:"Math (Ctrl-M)","class":"superscript",inline:{tag:"$$",insert:"$$${1:Math}$$"},block:{tag:"\n```\n",insert:"\n```math\n${1:}\n```\n"}}},i=function(e,t){var i=e.session.getTextRange(e.getSelectionRange()),a=t.insert;if(""!==i&&(a=a.replace(/\{1:.*\}/g,"{1:"+i+"}")),""!==i){var n=e.getSelectionRange(),o={start:{row:n.start.row,column:n.start.column-t.tag.length},end:n.start},s={start:n.end,end:{row:n.end.row,column:n.end.column+t.tag.length}};e.session.getTextRange(o)==t.tag&&e.session.getTextRange(s)==t.tag&&(e.selection.setSelectionRange({start:o.start,end:s.end}),a="${1:"+i+"}")}ace.snippetManager.insertSnippet(e,a)},a=function(e,t){for(var i=e.getSelectionRange(),a=[],n=i.end.row-i.start.row+1,o=0,s=0;n>s;s++){var r={start:{row:i.start.row+s,column:0},end:{row:i.start.row+s,column:t.insert.length}};a.push(r),e.session.getTextRange(r)==t.insert&&o++}for(var s=0;n>s;s++){var l=a[s];n==o?e.session.doc.remove(l):e.session.doc.insert({row:l.start.row,column:0},t.insert)}},n=function(e,t){var i=e.session.getTextRange(e.getSelectionRange()),a=t.insert;""!==i&&(a=a.replace(/\{1:.*\}/g,"{1:"+i+"}")),ace.snippetManager.insertSnippet(e,a)},o=function(e,t){var a=e.session.getTextRange(e.getSelectionRange()),n=e.getSelectionRange(),o=e.session.getLine(n.start.row),s={type:"inline",tag:t.inline.tag,insert:t.inline.insert,title:t.title};(n.start.row!=n.end.row||a===o.replace(/(^\s*)|(\s*$)/g,""))&&(s={type:"inline",tag:t.block.tag,insert:t.block.insert,title:t.title}),i(e,s)},s=function(){var e=["bold","italic","strikethrough","|","h1","line","quote","list_order","list_unorder","|","link","image","code","table","math"],i="";return $.each(e,function(e,a){if("|"==a)i+="<span class='md-tools md-tools-split'>|</span>";else{var n=t[a],o="class='md-tools md-tools-"+a+" "+(n["class"]?"icon-"+n["class"]:"")+"' ";i+="<a href='javascript:void(0);' title='"+n.title+"' "+o+" data-action='"+a+"'></a>"}}),i},r=function(e){core.api.pathSelect({type:"file",title:LNG.path_api_select_image,allowExt:"png|jpg|bmp|gif|jpeg|ico|svg|tiff"},function(t){core.fileLink(t,function(i){var a=core.pathThis(t),n="!["+a+"]("+i+")";ace.snippetManager.insertSnippet(e,n)})})},l=function(s){var l=t[s],c=e();if(l&&c){switch(l.type){case"inline":i(c,l,s);break;case"head":a(c,l,s);break;case"insert":n(c,l,s);break;case"inlineBlock":o(c,l,s);break;case"image":r(c);break;default:}e().focus()}},c=function(e){e.find(".md-tools[data-action]").bind("click",function(){var e=$(this).attr("data-action");l(e)})},d=function(e){$.each(t,function(i){var a=t[i];if(a.title&&a.title.match(/\((.*)\)/)){var n=a.title.match(/\((.*)\)/)[1],o=n.replace("Ctrl","Command");e.commands.addCommand({name:i,bindKey:{win:n,mac:o},exec:function(e){"ace/mode/markdown"==e.session.$modeId&&l(i)}})}})};return{bindEvent:function(e,t){e.find(".toolbar .content").html(s()),c(e),"ace/mode/markdown"==t.session.$modeId&&d(t)},doAction:l}}),define("app/src/edit/tpl/markdown_help_cn.html",[],'<div class="col-xs-5 col-md-3">\n<h5>1.标题与文字格式</h5>\n<p>标题</p>\n<pre>\n# 一级标题\n## 二级标题\n### 三级标题\n#### 四级标题\n##### 五级标题\n</pre>\n<p>文字格式</p>\n<pre>\n*斜体*\n**粗体**\n***粗斜体*** \n~~删除线~~\n</pre>\n<p>水平线</p>\n<pre>\n--- \n</pre> \n<a href="http://wowubuntu.com/markdown/" target="_blank">了解更多</a>\n</div>\n\n<div class="col-xs-5 col-md-3">\n<h5>2.列表</h5>\n<p>无序列表</p>\n<pre>\n- item 1\n- item 2\n* item 3\n(可以是[减号,星号,加号]+空格)\n</pre> \n<p>有序列表</p>\n<pre>\n1. item 1 [数字+空格]\n2. item 2\n3. item 3\n   - child 1\n   - child 2\n</pre>\n</div>\n\n<div class="col-xs-5 col-md-4">\n<h5>3.其他</h5>\n<p>图片</p>\n<pre>\n![图片名称](http://图片网址)\n</pre> \n\n<p>连接</p>\n<pre>\n[链接名称](http://链接网址)\n&lt;http://链接网址&gt;\n</pre> \n\n<p>引用</p>\n<pre>\n> 引用\n> 折行可以不加，新起一行要加\n</pre> \n\n<p>代码</p>\n<pre>\n行内代码:`code`\n```\nvar msg = "多行代码";\nalert(msg);\n```\n</pre> \n\n<p>公式</p>\n<pre>\n行内公式 $$E=mc^2$$ ;\n\n多行公式\n$$E=mc^2$$\n\n多行公式2\n```math\nE=mc^2\n```\n</pre>\n<a href=\'javascript:core.openWindow("http://tool.oschina.net/js/mathml/index.html");\' target="_blank">编辑器</a>\n  |  <a href=\'http://xiang.leanote.com/post/introduction-to-mathjax-and-latex-expression\' target="_blank">公式教程</a>\n</div>	\n'),define("app/src/edit/tpl/markdown_help.html",[],'<div class="col-xs-5 col-md-3">\n<h5>1.Headers and Emphasis</h5>\n<p>Headers</p>\n<pre>\n# Header 1\n## Header 2\n### Header 3\n#### Header 4\n##### Header 5\n</pre>\n<p>Emphasis</p>\n<pre>\n*Emphasis*\n**Strong**\n***Emphasis Strong*** \n~~Strikethrough~~\n</pre>\n<p>Line</p>\n<pre>\n--- \n</pre> \n<a href="http://wowubuntu.com/markdown/" target="_blank">Learn More</a>\n</div>\n\n<div class="col-xs-5 col-md-3">\n<h5>2.Lists</h5>\n<p>Unordered list</p>\n<pre>\n- item 1\n- item 2\n* item 3\n(also[- ,* ,+ )\n</pre> \n<p>Ordered list</p>\n<pre>\n1. item 1\n2. item 2\n3. item 3\n   - child 1\n   - child 2\n</pre>\n</div>\n\n<div class="col-xs-5 col-md-4">\n<h5>3.Others</h5>\n<p>Image</p>\n<pre>\n![Alt text](http://img.png)\n</pre> \n\n<p>Links</p>\n<pre>\n[Link text](http://url)\n&lt;http://url&gt;\n</pre> \n\n<p>Blockquotes</p>\n<pre>\n> Are you \n> ok ?\n</pre> \n\n<p>Code</p>\n<pre>\ninline code:`code`\n```\nvar msg = "Block code";\nalert(msg);\n```\n</pre> \n\n<p>LaTeX Math</p>\n<pre>\ninline $$E=mc^2$$ ;\n\nblock\n$$E=mc^2$$\n\nblock2\n```math\nE=mc^2\n```\n</pre>\n<a href=\'javascript:core.openWindow("http://tool.oschina.net/js/mathml/index.html");\' target="_blank">Math Editor</a>  \n</div>	\n'),define("app/src/edit/tpl/edit_tab_content.html",[],'<div class="edit_content">\n	<pre id="{{uuid}}" class="ace_editor_content"></pre>\n	<div class="resize hidden"></div><!-- 预览 -->\n	<div class="edit_right_frame hidden">\n		<div class="right_main">\n			<div class="function_list_frame hidden">\n				<div class="function_list_tool">\n					<div class="box">\n						<span> <i class="icon-code"></i>{{LNG.function_list}}</span>\n						<a href="javascript:;" class="tool_close" title="{{LNG.close}}"><i class="font-icon icon-remove"></i></a>\n					</div>\n					<div class="function_search">\n						<input type="text" placeholder="Search(ctrl+shift+e)">\n						<i class="font-icon icon-remove-sign search_reset hidden"> </i>\n					</div>\n				</div>\n				<div class="function_list_parent">\n					<div class="function_list_box"></div>\n				</div>\n			</div>\n			<!-- 函数列表 -->\n\n			<div class="preview_url_frame can_right_menu hidden">\n				<div class="preview_url_tool">\n					<div class="input_content"><input type="text" value=""/></div>\n					<div class="box">\n						<a href="javascript:;" class="tool_open_url" title="{{LNG.open_ie}}"><i class="font-icon icon-external-link"></i></a>\n						<a href="javascript:;" class="tool_refresh" title="{{LNG.refresh}}"><i class="font-icon icon-refresh"></i></a>\n						<a href="javascript:;" class="tool_close" title="{{LNG.close}}"><i class="font-icon icon-eye-close"></i></a>\n					</div>\n				</div>\n				<div class="preview_frame_content">\n					<iframe src="" style="width:100%;height:98%;border:0;"></iframe>\n				</div>\n			</div>\n			<!-- url浏览 -->\n\n			<div class="preview_markdown_frame can_right_menu hidden">\n				<div class="preview_markdown_tool">\n					<div class="toolbar"><div class="content"></div></div>\n					<div class="box">\n						<div class="content">\n							<a href="javascript:;" markdown_action="tool_markdown_menu" title="{{LNG.download}}"><i class="font-icon icon-reorder"></i></a>\n							<a href="javascript:;" markdown_action="tool_markdown_max" title="{{LNG.open_ie}}"><i class="font-icon icon-resize-full"></i></a>\n							<a href="javascript:;" markdown_action="tool_markdown_full" title="{{LNG.close}}"><i class="font-icon icon-columns"></i></a>\n							<a href="javascript:;" markdown_action="tool_markdown_setting" title="{{LNG.more}}"><i class="font-icon icon-ellipsis-horizontal"></i></a>\n						</div>						\n					</div>\n					<div class="markdown_setting hidden">\n						<ul>\n							<li><a href="javascript:;" markdown_action="tool_open_url"><i class="icon-external-link"></i>{{LNG.preview}}</a></li>\n							<li class="line"></li>\n							<li><a href="javascript:;" markdown_action="tool_markdown_download_html"><i class="icon-cloud-download"></i>{{LNG.download}} html</a></li>\n							<li><a href="javascript:;" markdown_action="tool_markdown_download_markdown"><i class="icon-cloud-download"></i>{{LNG.download}} markdown</a></li>\n							<li><a href="javascript:;" markdown_action="tool_markdown_download_pdf"><i class="icon-cloud-download"></i>{{LNG.download}} pdf</a></li>\n							<li class="line"></li>\n							<li><a href="javascript:;" markdown_action="tool_markdown_help"><i class="icon-question"></i>{{LNG.help}}</a></li>\n						</ul>\n					</div>\n					<div class="markdown_help container-fluid hidden">\n						<h3>Markdown {{LNG.help}}</h3>\n						<div class="row content"></div>\n					</div>\n					<div class="markdown_menu_box hidden">\n						<h3>{{LNG.markdown_content}}</h3>\n						<div class="content"></div>\n					</div>\n				</div>\n				<div class="markdown_preview can_select"></div>\n			</div>\n			<!-- markdown -->\n		</div>\n	</div>\n</div>\n\n'),define("app/src/edit/taskTap",[],function(){var e=function(){$(".edit_tab .tab").live("mouseenter",function(){$(this).addClass("hover"),$(this).unbind("mousedown").mousedown(function(e){1!=e.which||$(this).hasClass("this")||$.nodeName(e.target,"A")||($(this).removeClass("hover").addClass("this"),Editor.select($(this).attr("uuid")))}).unbind("mouseup").mouseup(function(e){2==e.which&&Editor.remove($(this).attr("uuid"))})}).die("mouseleave").live("mouseleave",function(){$(this).removeClass("hover")}).die("dblclick").live("dblclick",function(e){stopPP(e)}),$(".edit_tab").die("dblclick").live("dblclick",function(e){Editor.add(),stopPP(e)}),$(".edit_tab .tab .close").live("click",function(){var e=$(this).parent().attr("uuid");Editor.remove(e)})},t=function(){$(".context-menu-list").filter(":visible").trigger("contextmenu:hide")},i=function(){$("body").click(t).contextmenu(t),$.contextMenu({zIndex:9999,selector:".edit_tab_menu",items:{refresh:{name:LNG.refresh+"<b>F5</b>",className:"refresh_tab",icon:"refresh",accesskey:"e"},sep1:"---------",close:{name:LNG.close,icon:"remove",className:"close_self",accesskey:"d"},close_left:{name:LNG.close_left,icon:"remove-sign",className:"close_left",accesskey:"l"},close_right:{name:LNG.close_right,icon:"remove-sign",className:"close_right",accesskey:"r"},close_others:{name:LNG.close_others,icon:"remove-sign",className:"close_others",accesskey:"o"},sep2:"--------",open_the_path:{name:LNG.open_the_path,icon:"plus",className:"edit_open_the_path",accesskey:"n"},preview:{name:LNG.preview,icon:"globe",className:"edit_preview",accesskey:"p"}},callback:function(e,t){var i=t.$trigger,a=i.attr("uuid");switch(e){case"refresh":Editor.refresh(a);break;case"close":Editor.remove(a);break;case"close_left":var n=$(".edit_tab .tabs .tab").index(i);$(".edit_tab .tabs .tab:lt("+n+")").each(function(){Editor.remove($(this).attr("uuid"))});break;case"close_right":var n=$(".edit_tab .tabs .tab").index(i);$(".edit_tab .tabs .tab:gt("+n+")").each(function(){Editor.remove($(this).attr("uuid"))});break;case"close_others":$(".edit_tab .tabs .tab").each(function(){var e=$(this).attr("uuid");e!=a&&Editor.remove(e)});break;case"open_the_path":var o=i.attr("title");if(""==o)return Tips.tips(LNG.not_exists,"warning"),void 0;var s=core.pathFather(o),r=ShareData.frameTop();r.core.openPath(s);break;case"preview":Toolbar.doAction("preview");break;default:}}})},a=function(){var e,t,i,a,n=!1,o=!1,s=0,r=0,l=0,c=0,d=0,p=0,u=0,f=0;$(".edit_tab .tab").die("mousedown").live("mousedown",function(t){$.nodeName(t.target,"A")||(e=$.nodeName(t.target,"SPAN")?$(t.target).parent():$(this),1==t.which&&(n=!0,this.setCapture&&this.setCapture(),$(document).mousemove(function(e){m(e)}),$(document).one("mouseup",function(e){v(e),this.releaseCapture&&this.releaseCapture()})))});var h=function(a){o=!0,s=a.pageX,l=a.pageY,$tab_parent=$(".edit_tab"),t=$(".edit_tab .tab"),$(".draggable-dragging").remove(),i=e.clone().addClass("draggable-dragging").prependTo("body"),p=$sizeInt(t.css("margin-right")),u=$tab_parent.width(),f=$tab_parent.get(0).getBoundingClientRect().left,f+=$(window).scrollLeft(),r=e.get(0).getBoundingClientRect().left,d=$sizeInt(t.css("width")),c=$sizeInt(t.css("height"));var n=e.get(0).getBoundingClientRect().top-$sizeInt(e.css("margin-top")),h=a.clientX-s+r;$("body").prepend("<div class='dragMaskView'></div>"),i.css({width:d+"px",top:n,left:h}),e.css("opacity",0)},m=function(a){if(n){0==o&&h(a);var u=a.clientX-s+r,f=a.clientY-l+c;i.css({left:u,top:f}),t.each(function(){var t=$(this).get(0).getBoundingClientRect().left;if(u>t&&t+d/2+p>u){if(e.attr("uuid")==$(this).attr("uuid"))return;_($(this).attr("uuid"),"left")}if(u>t-d/2+p&&t>u){if(e.attr("uuid")==$(this).attr("uuid"))return;_($(this).attr("uuid"),"right")}})}},_=function(i,n){if(!e.is(":animated")||a!=i){a=i,e.stop(!0,!0),$(".insertTemp").remove(),t=$(".edit_tab .tab");var o=e.width(),s=$(".edit_tab .tab_"+i),r=e.clone(!0).insertAfter(e).css({"margin-right":"0px",border:"none"}).addClass("insertTemp");"left"==n?e.after(s).css("width","0px"):(e.before(s).css("width","0px"),s.before(r)),e.animate({width:o+"px"},animate_time),r.animate({width:"0px"},animate_time,function(){$(this).remove(),t=$(".edit_tab .tab")})}},v=function(){if(n=!1,o=!1,startTime=0,$(".dragMaskView").remove(),Editor.current()&&Editor.current().focus(),void 0!=i){var t=e.get(0).getBoundingClientRect().left,a=e.get(0).getBoundingClientRect().top;i.animate({left:t+"px",top:a+"px"},animate_time,function(){e.css("opacity",1),$(this).remove()})}}},n=function(e,t,i){"remove"==e&&t.removeClass("edit_tab_menu");var a=1.4*animate_time,n=150,o=n,s=$(".edit_tab .tab.edit_tab_menu"),r=$sizeInt($(".edit_tab .tabs").width()),l=$sizeInt(s.css("margin-right"))+$sizeInt(s.css("border-right")),c=$sizeInt($(".edit_tab .add").css("width"))+30,d=s.length,p=Math.floor((r-c)/(n+l));switch(d>p&&(o=Math.floor((r-c)/d)-l),e){case"add":$(".edit_tab .tabs .this").css({"margin-top":"30px",width:o}).stop(1,1).animate({"margin-top":"0px"},a),s.animate({width:o+"px"},a);break;case"remove":void 0!=i&&Editor.select(i),t.stop(1,1).animate({width:"0","margin-top":"+=30"},a,function(){t.remove()}),s.stop(1,1).animate({width:o+"px"},a);break;case"resize":s.css("width",o+"px");break;default:}};return{rightMenu:{hidden:t},resetWidth:n,init:function(){e(),a(),i()}}}),define("app/src/edit/toolbar",[],function(){var e=function(){i(),$(".toolMenu").bind("click mouseup",stopPP),$(".toolMenu").on("mousedown",function(){$(".toolMenu").removeClass("select"),$(this).addClass("select"),$(this).contextMenu({action:e})});var e=function(e,t){if(t.parent().hasClass("top_toolbar"))e.css({left:t.offset().left-4,top:t.outerHeight()-1});else if(t.parent().hasClass("bottom_toolbar")){var i=t.offset().left-e.outerWidth()+t.outerWidth()-5;e.css({left:i,top:t.offset().top-e.outerHeight()})}e.find("input").length>=1&&setTimeout(function(){e.find("input").focus()},10)};$.contextMenu({selector:".menuViewGotoline",trigger:"none",callback:n,items:{gotoline:{name:LNG.goto,className:"disable gotoline_input",type:"text"}}}),$.contextMenu({selector:".menuViewTab",trigger:"none",callback:n,items:{soft_tab:{name:"Soft Tabs (spaces)",className:"soft_tab"},sep1:"---------",tab_size_2:{name:"Tab with:2",className:"tab_size_set tab_size_2"},tab_size_3:{name:"Tab with:3",className:"tab_size_set tab_size_3"},tab_size_4:{name:"Tab with:4",className:"tab_size_set tab_size_4"},tab_size_8:{name:"Tab with:8",className:"tab_size_set tab_size_8"},sep2:"---------",convert_to_space:{name:"Convert To Space",className:"convert_to_space"},convert_to_tab:{name:"Convert To Tabs",className:"convert_to_tab"}}});for(var t=G.code_font_all.split(","),a={},s=0;t.length>s;s++){var r=t[s],l=replaceAll(r," ","_");a["set_font_family_"+r]={name:r,className:"set_font_family_"+l}}$.contextMenu({selector:".menuViewSetting",trigger:"none",callback:n,items:{tools:{name:LNG.tools,icon:"ellipsis-horizontal",accesskey:"m",items:{preview:{name:LNG.preview+"<b>Ctrl+Shift+S</b>",icon:"edit"},open_ie:{name:LNG.open_ie,icon:"external-link",accesskey:"b"},sep1:"---------",beautify_html:{name:"html "+LNG.beautify_code,icon:"angle-right"},beautify_css:{name:"css "+LNG.beautify_code,icon:"angle-right"},beautify_js:{name:"js "+LNG.beautify_code,icon:"angle-right"},sep10:"---------",beautify_php:{name:"php "+LNG.beautify_code,icon:"angle-right"}}},sep1:"---------",function_list:{name:LNG.function_list+"<b>Ctrl+Shift+E</b>",className:"function_list"},show_gutter:{name:LNG.show_gutter,className:"show_gutter"},auto_wrap:{name:LNG.wordwrap,className:"auto_wrap"},display_char:{name:LNG.char_all_display,className:"display_char"},sep2:"---------",font_family:{name:LNG.font_family,icon:"italic",className:"code_font_family_list",accesskey:"m",items:a},ace_mode:{name:LNG.keyboard_type,icon:"code",accesskey:"m",items:{keyboard_type_ace:{name:"Default",className:"keyboard_type_ace"},keyboard_type_vim:{name:"vim",className:"keyboard_type_vim"},keyboard_type_emacs:{name:"emacs",className:"keyboard_type_emacs"}}},sep3:"---------",help:{name:LNG.help,icon:"question",items:{shortcut:{name:LNG.shortcut,icon:"keyboard"},about:{name:LNG.about,icon:"info-sign"},emmet:{name:"Emmet help",icon:"code"},sep4:"-----------",learnMore:{name:LNG.learn_more,icon:"external-link"}}}}}),$(".tools [action]").bind("click",function(e){var t=$(this).attr("action");return n(t),Editor.current()&&Editor.current().focus(),stopPP(e),!1}),$(".tab_size_set").click(function(){var e=$(this).text().split(":");Editor.saveConfig("tab_size",e[1]),Editor.current()&&Editor.current().focus(),Editor.current().execCommand("convertIndent","reset_size")}),$("ul.code_font_family_list .context-menu-item").click(function(){Editor.saveConfig("font_family",$(this).find("span").html(),""),Editor.current()&&Editor.current().focus(),o()}),$("body").click(function(e){try{$(".toolMenu").removeClass("select"),window.parent.rightMenu.hidden(),e&&$(e.target).is("textarea")||$(e.target).is("input")||0!=$(e.target).parents(".right_main").length||Editor.current()&&Editor.current().focus()}catch(e){}}),$(".gotoline_input input").keyup(function(){Editor.current().gotoLine($(this).val())})},t=function(){var e=Editor.aceModeList.modes,t='<ul class="dropdown-menu code_mode_list hidden">';t+='<li class="list_input"><input type="text" value="" name="menu_mode_input" /></li>';for(var i=0;e.length>i;i++)t+='<li class="list_cell" mode_name="'+e[i].name+'">'+e[i].caption+"</li>";$(t+"<ul>").appendTo("body");var a=function(){$(".file_mode").removeClass("select"),$(".code_mode_list").addClass("hidden"),$(".code_mode_list input").val(""),$(".code_mode_list .list_cell").removeClass("hidden").removeClass("hover");var e=$(".code_mode_list .selected").attr("mode_name"),t=Editor.current().kod.mode;Editor.current().getSession().setMode("ace/mode/"+e),Editor.current().kod.mode=e,Editor.current()&&Editor.current().focus(),o(),"markdown"==e&&n("preview"),"markdown"==t&&e!=t&&n("previewClose")};$(".file_mode").mousedown(function(){$(".file_mode").addClass("select"),$(".code_mode_list").removeClass("hidden");var e=$(window).width()-$(".file_mode").offset().left-$(".file_mode").outerWidth();$(".code_mode_list").css("right",e)}).mouseup(function(){$(".code_mode_list input").textFocus(),setTimeout(function(){$(".code_mode_list input").focus()},50)}),$("body").mousedown(function(e){!$(".file_mode").hasClass("select")||0!=$(e.target).parents(".code_mode_list").length||$(e.target).hasClass("file_mode")||$(e.target).hasClass("code_mode_list")||a()}),$(".code_mode_list input").keyup(function(e){var t=$(".code_mode_list .list_cell:not(.hidden)"),i=t.index($(".code_mode_list .hover"));switch(e.keyCode){case 38:if(i>0){$(".code_mode_list .hover").removeClass("hover");var n=$(t.get(i-1)).addClass("hover"),o=$(".code_mode_list");1==n.length&&(o.scrollTop(n.offset().top+o.scrollTop()-o.offset().top-50),Editor.current().getSession().setMode("ace/mode/"+n.attr("mode_name")))}return stopPP(e),void 0;case 40:if(t.index(".hover")<t.length-1){$(".code_mode_list .hover").removeClass("hover");var n=$(t.get(i+1)).addClass("hover"),o=$(".code_mode_list");1==n.length&&(o.scrollTop(n.offset().top+o.scrollTop()-o.offset().top-50),Editor.current().getSession().setMode("ace/mode/"+n.attr("mode_name")))}return stopPP(e),void 0;case 27:return a(),void 0;case 13:return $(".code_mode_list .selected").removeClass("selected"),$(".code_mode_list .hover").addClass("selected"),a(),void 0;default:}var s=$(this).val().toLocaleLowerCase(),r="hidden",l="";$(".code_mode_list .list_cell").each(function(){var e=$(this).removeClass("hover").html().toLocaleLowerCase();-1!=e.indexOf(s)?(""==l&&(l=$(this).addClass("hover"),Editor.current().getSession().setMode("ace/mode/"+$(this).attr("mode_name"))),$(this).removeClass(r)):$(this).addClass(r)})}),$(".code_mode_list .list_cell").mouseenter(function(){$(".code_mode_list .hover").removeClass("hover"),$(this).addClass("hover"),Editor.current().getSession().setMode("ace/mode/"+$(this).attr("mode_name")),$(this).unbind("click").click(function(){$(this).parent().find(".list_cell").removeClass("selected"),$(this).addClass("selected"),a()})}).mouseleave(function(){$(this).removeClass("hover"),Editor.current().getSession().setMode("ace/mode/"+Editor.current().kod.mode)})},i=function(){t(),$(".top_boolbar a").attr("draggable","false"),$(".bottom_toolbar a").attr("draggable","false");for(var e=[12,13,14,15,16,18,20,22,24,26,28,32],i=G.code_theme_all.split(","),a={},o={},s=0;e.length>s;s++){var r=e[s];a["set_code_font-"+r]={name:r+"px",className:"set_code_font_"+r}}for(var s=0;i.length>s;s++){var l=i[s],c={name:l,className:"set_code_theme_"+l};"ambiance"==l&&(c.className+=" line_top"),o["set_code_theme-"+l]=c}$.contextMenu({selector:".menuViewFont",trigger:"none",className:"code_font_list",callback:n,items:a}),$.contextMenu({selector:".menuViewTheme",trigger:"none",className:"code_theme_list",callback:n,items:o}),$("ul.code_font_list .context-menu-item").mouseenter(function(){Editor.current().setFontSize($(this).text()),$(this).unbind("click").click(function(){var e=$(this).text();Editor.saveConfig("font_size",e),Editor.current()&&Editor.current().focus()})}).mouseleave(function(){Editor.current().setFontSize(G.code_config.font_size)});var d=function(e){Editor.isBlackTheme(e)?$("body").addClass("code_theme_black"):$("body").removeClass("code_theme_black")};$("ul.code_theme_list .context-menu-item").mouseenter(function(){var e=$(this).find("span").html();d(e),Editor.current()&&Editor.current().setTheme("ace/theme/"+e),$(this).unbind("click").click(function(){var e=$(this).find("span").html();Editor.saveConfig("theme",e),Editor.current()&&Editor.current().focus(),d(e)})}).mouseleave(function(){Editor.current()&&Editor.current().setTheme("ace/theme/"+G.code_config.theme),d(G.code_config.theme)})},a=function(e){var t=Editor.current().getValue(),i=""==Editor.current().session.getTextRange()?!0:!1;i||(t=Editor.current().session.getTextRange());var a={brace_style:"collapse",break_chained_methods:!1,indent_char:" ",indent_scripts:"keep",indent_size:"4",keep_array_indentation:!0,preserve_newlines:!0,space_after_anon_function:!0,space_before_conditional:!0,unescape_strings:!1,wrap_line_length:"120"};switch(e){case"beautify_html":t=html_beautify(t,a);break;case"beautify_css":t=css_beautify(t);break;case"beautify_js":t=js_beautify(t);break;case"beautify_php":return Editor.current().execCommand("phpBeautify"),void 0}i?Editor.current().setValue(t):Editor.current().insert(t)},n=function(e){if("newfile"==e)return Editor.add(),void 0;if(Editor.current())switch(e){case"fullscreen":$(".icon-resize-full").toggleClass("icon-resize-small"),ShareData.frameTop("",function(e){e.core.editorFull()});break;case"save":Editor.save();break;case"saveall":Editor.saveall();break;case"undo":Editor.current().undo();break;case"redo":Editor.current().redo();break;case"refresh":Editor.refresh();break;case"delete":Editor.current().execCommand("del");break;case"selectAll":Editor.current().execCommand("selectall");break;case"startAutocomplete":Editor.current().execCommand("startAutocomplete");break;case"search":Editor.current().execCommand("find");break;case"searchReplace":Editor.current().execCommand("replace");break;case"auto_wrap":Editor.saveConfig("auto_wrap");break;case"display_char":Editor.saveConfig("display_char");break;case"show_gutter":Editor.saveConfig("show_gutter");break;case"setting":Editor.doAction("setting");break;case"soft_tab":Editor.saveConfig("soft_tab");break;case"convert_to_space":Editor.current().execCommand("convertIndent","to_space");break;case"convert_to_tab":Editor.current().execCommand("convertIndent","to_tabs");break;case"auto_complete":Editor.saveConfig("auto_complete");break;case"keyboard_type_ace":Editor.saveConfig("keyboard_type","ace");break;case"keyboard_type_vim":Editor.saveConfig("keyboard_type","vim");break;case"keyboard_type_emacs":Editor.saveConfig("keyboard_type","emacs");break;case"beautify_html":a(e);break;case"beautify_css":a(e);break;case"beautify_js":a(e);break;case"beautify_php":a(e);break;case"open_ie":url=core.path2url(Editor.current().kod.filename),window.open(url);break;case"function_list":var t=Editor.current().kod.preview;t.openFunctionList();break;case"preview":var t=Editor.current().kod.preview;t.previewForce();break;case"previewClose":var t=Editor.current().kod.preview;t.close();break;case"close":Editor.remove();break;case"about":core.setting("about");break;case"emmet":window.open("http://docs.emmet.io/");break;case"shortcut":Editor.current().execCommand("showKeyboardShortcuts");break;case"learnMore":window.open("http://kalcaddle.com/editor.html");
break;default:}},o=function(){var e=G.code_config,t=["function_list","auto_complete","auto_wrap","display_char","soft_tab","show_gutter"];$(".context-menu-root .context-menu-item").removeClass("selected");for(var i=0;t.length>i;i++)"1"==e[t[i]]&&$(".context-menu-root ."+t[i]).addClass("selected");$(".set_code_theme_"+e.theme).addClass("selected"),$(".set_code_font_"+e.font_size.substr(0,2)).addClass("selected"),$(".tab_size_"+e.tab_size).addClass("selected"),$(".keyboard_type_"+e.keyboard_type).addClass("selected");var a=replaceAll(e.font_family," ","_");if($(".set_font_family_"+a).addClass("selected"),Editor.current()){var n=Editor.aceModeList.modesByName[Editor.current().kod.mode].caption;$(".code_mode_list .list_cell").removeClass("selected").removeClass("hidden"),$(".code_mode_list [mode_name="+Editor.current().kod.mode+"]").addClass("selected"),$(".bottom_toolbar .file_mode").html(n),$(".bottom_toolbar .config_tab").html("Tabs:"+e.tab_size)}};return{doAction:n,toolbarSelected:o,init:function(){e(),Mousetrap.bind(["ctrl+s","command+s"],function(e){e.preventDefault(),e.returnvalue=!1,Editor.save()}),Mousetrap.bind(["ctrl+shift+e","command+shift+e"],function(e){e.preventDefault(),e.returnvalue=!1,Toolbar.doAction("function_list")}),Mousetrap.bind(["f5"],function(){Editor.refresh()})}}});